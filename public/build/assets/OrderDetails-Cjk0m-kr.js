import{m as x,z as $,g as n,o as s,b as t,i as d,F as w,q as C,f as g,t as y,a as q,w as G,k as h,A as D,p as S,B as I,S as _,s as T}from"./app-CMckr95Y.js";import{_ as O}from"./Modal-zqTQ4tk1.js";const V={class:"bg-white p-6 rounded-lg shadow-md flex overflow-y-auto justify-between max-h-64 hover:scale-[1.02] transition-all transform ease-in-out duration-300"},U={class:"flex flex-col gap-2"},A={key:0,src:"assets/icons/svg/details/utensils.svg",alt:"Food Icon",class:"inline w-5 ml-2 cursor-pointer"},F={key:1,src:"assets/icons/svg/details/drink.svg",alt:"Drink Icon",class:"inline w-5 ml-2 cursor-pointer"},H={key:1,class:"text-gray-400"},L={key:0,class:"h-fit overflow-auto flex flex-col gap-2 items-end"},P={key:0,class:"text-center"},Y={key:1,class:"text-gray-400"},z={class:"bg-white p-6 rounded-lg shadow-md flex h-fit justify-between hover:scale-[1.02] transition-all transform ease-in-out duration-300"},J={class:"flex items-center gap-4"},R={class:"font-bold text-2xl 2xl:text-3xl"},K={class:"p-8 bg-gradient-to-br from-white via-gray-50 to-gray-200 rounded-2xl shadow-2xl mx-auto"},Q={key:0,class:"mb-4"},W={key:0,class:"mt-2"},X={class:"flex justify-end gap-3 mt-8"},te={__name:"OrderDetails",props:{order:Object},setup(l){const r=l,i=x(!1),M=()=>{i.value=!1},f=x("Efectivo"),p=x("0"),v=x(""),u=$().props.auth.user;console.log("order prop in <OrderDetails>: ",r.order);const B=[1,2,3,4,6,7,8,20],E=[5,9,10,11,12,13,14,15,16,17,18,19],N=async()=>{M(),(await _.fire({icon:"info",title:"Estás segur@ de cobrar la orden?",text:"Asegurate primero de haber cobrado el monto correcto.",showCancelButton:!0,confirmButtonText:"Sí, cobrar",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#d33"})).isConfirmed&&r.order&&r.order.id&&r.order.order_details&&(await T.post(`/Order/AddTip/${r.order.id}`,{tip_percent:p.value?Number(p.value):null,tip:v.value?Number(v.value):null}),await T.post("/Sales/Create",{order_id:r.order.id,user_id:u.id,cash_audit_id:null,payment_method:f.value,sales:r.order.order_details.map(e=>({product_id:e.product_id,quantity:e.quantity,unit_price:e.unit_price??(e.product?e.product.price:0),subtotal:e.total??e.quantity*(e.unit_price??(e.product?e.product.price:0))}))}),_.fire({icon:"success",title:"¡Venta creada exitosamente!",showConfirmButton:!1,timer:1500}))},j=()=>{if(r.order&&r.order.id){const b={total:r.order.total,items:r.order.order_details.length,cash:r.order.total,change:0,user_id:u.name,updated_at:new Date().getFullYear()+"-"+(new Date().getMonth()+1)+"-"+new Date().getDate()+" "+new Date().getHours()+":"+new Date().getMinutes(),created_at:new Date().getFullYear()+"-"+(new Date().getMonth()+1)+"-"+new Date().getDate()+" "+new Date().getHours()+":"+new Date().getMinutes(),id:r.order.id,user:{id:u.id,name:u.name,email:u.email,role:u.role},table:r.order.table?r.order.table.number:0},e=r.order.order_details.map(a=>({price:a.unit_price??(a.product?a.product.price:0),quantity:a.quantity,name:a.product?a.product.name:""})),m={name:"Hotel Ronda Minerva",address:"Av. Adolfo López Mateos Sur 265, Jardines del Bosque, 44520 Guadalajara, Jal.",phone:"33 3121 4700"};I.get("/print-ticket/",{params:{data:{ticketData:b,ticketItems:e,businessInfo:m}}}).then(a=>{if(a.data&&a.data.printData){const c="print://"+a.data.printData;console.clear(),console.log(c),console.log("Print URL:",c),window.location.href=c,console.log("Ticket data sent successfully:",a.data)}else console.error("No print data received from server.")}).catch(a=>{console.error("Error sending ticket data:",a)})}else console.error("No order data available to print ticket.")};return(b,e)=>{var m,a,c,k;return s(),n(w,null,[e[15]||(e[15]=t("h2",{class:"text-lg font-semibold mt-2 mb- text-center text-white"}," Detalles de la orden ",-1)),t("div",V,[t("div",U,[l.order&&l.order.order_details&&l.order.order_details.length?(s(!0),n(w,{key:0},C(l.order.order_details,o=>(s(),n("span",{key:o.id},[o.product&&B.includes(o.product.category_id)?(s(),n("img",A)):o.product&&E.includes(o.product.category_id)?(s(),n("img",F)):d("",!0),g(" "+y(o.quantity)+" x "+y(o.product?o.product.name:""),1)]))),128)):(s(),n("span",H,"No hay detalles para esta orden."))]),l.order&&l.order.order_details&&l.order.order_details.length?(s(),n("div",L,[(s(!0),n(w,null,C(l.order.order_details,o=>(s(),n("div",{key:o.id},[o.product&&o.product.category_id===2?(s(),n("span",P)):d("",!0),g(" $ "+y(o.unit_price*o.quantity),1)]))),128))])):(s(),n("span",Y,"No hay detalles para esta orden."))]),((m=l.order)==null?void 0:m.status)==="En curso"?(s(),n("button",{key:0,onClick:e[0]||(e[0]=o=>b.$inertia.get(`/Order/Edit/${l.order.id}`)),class:"bg-orangeYellow hover:bg-yellow-600 transform transition-all duration-300 ease-in-out text-white font-bold py-2 px-4 rounded"}," Editar Orden ")):d("",!0),t("div",z,[e[14]||(e[14]=t("h3",{class:"font-bold text-3xl"},"Total:",-1)),t("div",J,[t("span",R," $ "+y((a=r.order)!=null&&a.total?r.order.total:"0.00"),1),((c=r.order)==null?void 0:c.status)==="En curso"?(s(),n("button",{key:0,onClick:e[1]||(e[1]=o=>i.value=!0),class:"bg-approveGreen hover:bg-green-900 transition-all transform duration-300 ease-in-out text-white px-4 py-2 rounded-lg"}," Cobrar ")):d("",!0),(k=r.order)!=null&&k.status?(s(),n("button",{key:1,onClick:j,class:"bg-approveGreen hover:bg-green-900 transition-all transform duration-300 ease-in-out text-white px-4 py-2 rounded-lg"}," Imprimir Ticket ")):d("",!0)]),q(O,{show:i.value,"onUpdate:show":e[6]||(e[6]=o=>i.value=o),onClose:e[7]||(e[7]=o=>i.value=!1)},{default:G(()=>[t("div",K,[e[12]||(e[12]=t("h3",{class:"text-2xl font-extrabold text-gray-800 mb-2 flex items-center gap-2"},[t("svg",{class:"w-7 h-7 text-approveGreen",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{d:"M12 8v4l3 3"}),t("circle",{cx:"12",cy:"12",r:"10"})]),g(" Cobrar Orden ")],-1)),e[13]||(e[13]=t("p",{class:"mb-6 text-gray-600 text-base"},[g(" ¿Cuál será el "),t("span",{class:"font-semibold text-approveGreen"},"método de pago"),g(" para esta orden? ")],-1)),h(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>f.value=o),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-4"},[...e[8]||(e[8]=[t("option",{value:"Efectivo"},"Efectivo",-1),t("option",{value:"Tarjeta"},"Tarjeta de Crédito/Débito",-1)])],512),[[D,f.value]]),f.value==="Tarjeta"?(s(),n("div",Q,[e[11]||(e[11]=t("label",{class:"block text-gray-700 font-medium mb-2"},"El cliente gusta dejar propina de:",-1)),h(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>p.value=o),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-2"},[...e[9]||(e[9]=[t("option",{value:"0"},"No dejar propina",-1),t("option",{value:"5"},"5%",-1),t("option",{value:"10"},"10%",-1),t("option",{value:"15"},"15%",-1),t("option",{value:"20"},"20%",-1),t("option",{value:"otherTip"},"Otro",-1)])],512),[[D,p.value]]),p.value==="otherTip"?(s(),n("div",W,[e[10]||(e[10]=t("label",{class:"block text-gray-700 font-medium mb-1"},"Ingrese el monto de propina:",-1)),h(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>v.value=o),type:"number",min:"0",class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition",placeholder:"Monto de propina"},null,512),[[S,v.value]])])):d("",!0)])):d("",!0),t("div",X,[t("button",{onClick:e[5]||(e[5]=o=>i.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Cancelar "),t("button",{onClick:N,class:"bg-approveGreen hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition"}," Sí, Cobrar ")])])]),_:1},8,["show"])])],64)}}};export{te as default};
