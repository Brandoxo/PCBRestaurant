import{m as v,z as V,g as a,o as s,b as t,i as d,a as E,F as C,q as M,f as i,t as w,k as h,v as I,w as O,A as S,p as U,B as A,S as k,s as _}from"./app-BTgeQ286.js";import{_ as F}from"./Modal-mkrzPAHm.js";import{S as H}from"./Switch-SN9fSirE.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const L={class:"bg-white p-6 rounded-lg shadow-md flex overflow-y-auto justify-between max-h-64 hover:scale-[1.02] transition-all transform ease-in-out duration-300"},P={class:"flex flex-col gap-2"},Y={key:0,src:"assets/icons/svg/details/utensils.svg",alt:"Food Icon",class:"inline w-5 ml-2 cursor-pointer"},z={key:1,src:"assets/icons/svg/details/drink.svg",alt:"Drink Icon",class:"inline w-5 ml-2 cursor-pointer"},J={key:1,class:"text-gray-400"},R={key:0,class:"h-fit overflow-auto flex flex-col gap-2 items-end"},K={key:0,class:"text-center"},Q={key:1,class:"text-gray-400"},W={class:"flex gap-4 w-full"},X={class:"bg-white p-6 rounded-lg shadow-md flex h-fit w-full justify-between hover:scale-[1.02] transition-all transform ease-in-out duration-300"},Z={class:"flex items-center gap-4"},ee={class:"font-bold text-2xl 2xl:text-3xl"},te={key:0,class:"bg-white p-4 rounded-lg shadow-md w-fit hover:scale-[1.02] transition-all transform ease-in-out duration-300"},oe={class:"inline-flex items-center cursor-pointer flex-col gap-1 font-bold"},re={key:0,class:"bg-gradient-to-br from-white via-gray-50 to-gray-200 p-4 rounded-2xl shadow-2xl mx-auto"},ae={class:"flex justify-end gap-3 mt-8"},se={key:1,class:"p-8 bg-gradient-to-br from-white via-gray-50 to-gray-200 rounded-2xl shadow-2xl mx-auto"},ne={key:0,class:"mb-4"},le={key:0,class:"mt-2"},ie={class:"flex justify-end gap-3 mt-8"},ge={__name:"OrderDetails",props:{order:Object},setup(l){const r=l,u=v(!1),D=()=>{u.value=!1},b=v("Efectivo"),g=v("0"),x=v(""),c=V().props.auth.user,m=v(!1);console.log("order prop in <OrderDetails>: ",r.order);const G=[1,2,3,4,6,7,8,20],j=[5,9,10,11,12,13,14,15,16,17,18,19],q=async()=>{D(),(await k.fire({icon:"info",title:"Estás segur@ de cobrar la orden?",text:"Asegurate primero de haber cobrado el monto correcto.",showCancelButton:!0,confirmButtonText:"Sí, cobrar",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#d33"})).isConfirmed&&r.order&&r.order.id&&r.order.order_details&&(await _.post(`/Order/AddTip/${r.order.id}`,{tip_percent:g.value?Number(g.value):null,tip:x.value?Number(x.value):null}),await _.post("/Sales/Create",{order_id:r.order.id,user_id:c.id,cash_audit_id:null,payment_method:b.value,sales:r.order.order_details.map(e=>({product_id:e.product_id,quantity:e.quantity,unit_price:e.unit_price??(e.product?e.product.price:0),subtotal:e.total??e.quantity*(e.unit_price??(e.product?e.product.price:0)),is_courtesy:m.value?1:0}))}),k.fire({icon:"success",title:"¡Venta creada exitosamente!",showConfirmButton:!1,timer:1500}))},N=async()=>{D(),(await k.fire({icon:"info",title:"Estás segur@ de crear una cortesía?",text:"Asegurate primero de haber revisado la orden.",showCancelButton:!0,confirmButtonText:"Sí, crear cortesía",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#d33"})).isConfirmed&&r.order&&r.order.id&&r.order.order_details&&(await _.post("/Sales/Create",{order_id:r.order.id,user_id:c.id,cash_audit_id:null,payment_method:"Cortesía",sales:r.order.order_details.map(e=>({product_id:e.product_id,quantity:e.quantity,unit_price:e.unit_price??(e.product?e.product.price:0),subtotal:e.total??e.quantity*(e.unit_price??(e.product?e.product.price:0)),is_courtesy:1}))}),k.fire({icon:"success",title:"¡Cortesía creada exitosamente!",showConfirmButton:!1,timer:1500}))},$=()=>{if(r.order&&r.order.id){const f={total:r.order.total,items:r.order.order_details.length,cash:r.order.total,change:0,user_id:c.name,updated_at:new Date().getFullYear()+"-"+(new Date().getMonth()+1)+"-"+new Date().getDate()+" "+new Date().getHours()+":"+new Date().getMinutes(),created_at:new Date().getFullYear()+"-"+(new Date().getMonth()+1)+"-"+new Date().getDate()+" "+new Date().getHours()+":"+new Date().getMinutes(),id:r.order.id,user:{id:c.id,name:c.name,email:c.email,role:c.role},table:r.order.table?r.order.table.number:0},e=r.order.order_details.map(n=>({price:n.unit_price??(n.product?n.product.price:0),quantity:n.quantity,name:n.product?n.product.name:""})),y={name:"Hotel Ronda Minerva",address:"Av. Adolfo López Mateos Sur 265, Jardines del Bosque, 44520 Guadalajara, Jal.",phone:"33 3121 4700"};A.get("/print-ticket/",{params:{data:{ticketData:f,ticketItems:e,businessInfo:y}}}).then(n=>{if(n.data&&n.data.printData){const p="print://"+n.data.printData;console.clear(),console.log(p),console.log("Print URL:",p),window.location.href=p,console.log("Ticket data sent successfully:",n.data)}else console.error("No print data received from server.")}).catch(n=>{console.error("Error sending ticket data:",n)})}else console.error("No order data available to print ticket.")};return(f,e)=>{var y,n,p,B,T;return s(),a(C,null,[e[20]||(e[20]=t("h2",{class:"text-lg font-semibold mt-2 mb- text-center text-white"}," Detalles de la orden ",-1)),t("div",L,[t("div",P,[l.order&&l.order.order_details&&l.order.order_details.length?(s(!0),a(C,{key:0},M(l.order.order_details,o=>(s(),a("span",{key:o.id},[o.product&&G.includes(o.product.category_id)?(s(),a("img",Y)):o.product&&j.includes(o.product.category_id)?(s(),a("img",z)):d("",!0),i(" "+w(o.quantity)+" x "+w(o.product?o.product.name:""),1)]))),128)):(s(),a("span",J,"No hay detalles para esta orden."))]),l.order&&l.order.order_details&&l.order.order_details.length?(s(),a("div",R,[(s(!0),a(C,null,M(l.order.order_details,o=>(s(),a("div",{key:o.id},[o.product&&o.product.category_id===2?(s(),a("span",K)):d("",!0),i(" $ "+w(o.unit_price),1)]))),128))])):(s(),a("span",Q,"No hay detalles para esta orden."))]),((y=l.order)==null?void 0:y.status)==="En curso"?(s(),a("button",{key:0,onClick:e[0]||(e[0]=o=>f.$inertia.get(`/Order/Edit/${l.order.id}`)),class:"bg-orangeYellow hover:bg-yellow-600 transform transition-all duration-300 ease-in-out text-white font-bold py-2 px-4 rounded"}," Editar Orden ")):d("",!0),t("div",W,[t("div",X,[e[10]||(e[10]=t("h3",{class:"font-bold text-3xl"},"Total:",-1)),t("div",Z,[t("span",ee," $ "+w((n=r.order)!=null&&n.total?r.order.total:"0.00"),1),((p=r.order)==null?void 0:p.status)==="En curso"?(s(),a("button",{key:0,onClick:e[1]||(e[1]=o=>u.value=!0),class:"bg-approveGreen hover:bg-green-900 transition-all transform duration-300 ease-in-out text-white px-4 py-2 rounded-lg"}," Cobrar ")):d("",!0),((B=r.order)==null?void 0:B.status)==="En curso"?(s(),a("button",{key:1,onClick:$,class:"bg-approveGreen hover:bg-green-900 transition-all transform duration-300 ease-in-out text-white px-4 py-2 rounded-lg"}," Imprimir Ticket ")):d("",!0)])]),((T=l.order)==null?void 0:T.status)==="En curso"?(s(),a("div",te,[t("label",oe,[e[11]||(e[11]=i(" ¿Cortesía? ",-1)),h(t("input",{type:"checkbox",class:"sr-only peer","onUpdate:modelValue":e[2]||(e[2]=o=>m.value=o),id:"is_active"},null,512),[[I,m.value]]),E(H)])])):d("",!0)]),E(F,{show:u.value,"onUpdate:show":e[8]||(e[8]=o=>u.value=o),onClose:e[9]||(e[9]=o=>u.value=!1)},{default:O(()=>[m.value===!0?(s(),a("div",re,[e[12]||(e[12]=t("h2",{class:"text-2xl font-extrabold text-gray-800 mb-2 flex items-center gap-2"},[t("svg",{class:"w-7 h-7 text-approveGreen",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{d:"M12 8v4l3 3"}),t("circle",{cx:"12",cy:"12",r:"10"})]),i(" Crear Cortesía ")],-1)),e[13]||(e[13]=t("p",{class:"mb-6 text-gray-600 text-base"},[i(" ¿Estás seguro de "),t("span",{class:"font-semibold text-approveGreen"},"crear cortesía"),i(" para esta orden? ")],-1)),t("div",ae,[t("button",{onClick:e[3]||(e[3]=o=>u.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Cancelar "),t("button",{onClick:N,class:"bg-approveGreen hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition"}," Sí, Crear Cortesía ")])])):(s(),a("div",se,[e[18]||(e[18]=t("h3",{class:"text-2xl font-extrabold text-gray-800 mb-2 flex items-center gap-2"},[t("svg",{class:"w-7 h-7 text-approveGreen",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{d:"M12 8v4l3 3"}),t("circle",{cx:"12",cy:"12",r:"10"})]),i(" Cobrar Orden ")],-1)),e[19]||(e[19]=t("p",{class:"mb-6 text-gray-600 text-base"},[i(" ¿Cuál será el "),t("span",{class:"font-semibold text-approveGreen"},"método de pago"),i(" para esta orden? ")],-1)),h(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>b.value=o),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-4"},[...e[14]||(e[14]=[t("option",{value:"Efectivo"},"Efectivo",-1),t("option",{value:"Tarjeta"},"Tarjeta de Crédito/Débito",-1)])],512),[[S,b.value]]),b.value==="Tarjeta"?(s(),a("div",ne,[e[17]||(e[17]=t("label",{class:"block text-gray-700 font-medium mb-2"},"El cliente gusta dejar propina de:",-1)),h(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>g.value=o),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-2"},[...e[15]||(e[15]=[t("option",{value:"0"},"No dejar propina",-1),t("option",{value:"5"},"5%",-1),t("option",{value:"10"},"10%",-1),t("option",{value:"15"},"15%",-1),t("option",{value:"20"},"20%",-1),t("option",{value:"otherTip"},"Otro",-1)])],512),[[S,g.value]]),g.value==="otherTip"?(s(),a("div",le,[e[16]||(e[16]=t("label",{class:"block text-gray-700 font-medium mb-1"},"Ingrese el monto de propina:",-1)),h(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>x.value=o),type:"number",min:"0",class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition",placeholder:"Monto de propina"},null,512),[[U,x.value]])])):d("",!0)])):d("",!0),t("div",ie,[t("button",{onClick:e[7]||(e[7]=o=>u.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Cancelar "),t("button",{onClick:q,class:"bg-approveGreen hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition"}," Sí, Cobrar ")])]))]),_:1},8,["show"])],64)}}};export{ge as default};
