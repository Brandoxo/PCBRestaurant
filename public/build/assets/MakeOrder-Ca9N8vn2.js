import{z as A,j as f,r as b,y as L,l as D,A as w,g as d,i as a,o as l,b as s,k as T,B as I,F as C,s as E,t as v,q as F,c as Q,C as H,S,x as P}from"./app-DYV40hgH.js";import{_ as J}from"./ReturnButton-fTr9OGW2.js";const K={key:0,class:"w-full px-8"},V={class:"bg-gray-100 p-8 rounded-xl shadow-lg hover:scale-[1.01] transform transition-transform duration-300 ease-in-out mt-4 lg:mt-0"},W={key:0,class:"mt-4"},X=["value"],Y={key:0,class:"text-center text-gray-500"},Z={class:"list-disc list-inside max-h-96 2xl:max-h-[30rem] overflow-y-auto grid grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4"},ee={class:"bg-white rounded shadow flex justify-between items-center flex-col"},re=["src"],te={class:"font-bold"},oe={class:"font-extrabold text-black text-lg mb-"},se={class:"flex justify-evenly w-full m-4 text-center items-center"},le=["onClick"],de={key:1,disabled:"",class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-gray-400/80 text-white cursor-not-allowed"},ne={class:"text-lg font-bold text-gray-700"},ae=["onClick"],ie={class:"flex justify-between mt-6"},me={__name:"MakeOrder",props:{tables:Object,orders:Object,selectedTable:Object,currentOrder:Object,isEdit:Boolean,localNotes:String},emits:["closeOptions"],setup(n,{emit:q}){const e=n,x=A().props.auth.user,_=f(()=>x&&x.permissions&&x.permissions.includes("edit orders")),O=b(""),j=f(()=>{let r=m.value;return g.value!=="all"?r=r.filter(t=>t.category.name===g.value&&t.is_active):r=r.filter(t=>t.is_active),O.value&&(r=r.filter(t=>t.name.toLowerCase().includes(O.value.toLowerCase().trim()))),r}),y=q;function B(){y("closeOptions"),h(),console.log("Close Options clicked, order reset to normal state:",e.currentOrder)}const u=L(),R=()=>{if(console.log("Save Order clicked with current order:",e.currentOrder),w(()=>{e.currentOrder.notes=e.localNotes??null}),!e.currentOrder.mesa_id&&!e.currentOrder.room_id||e.currentOrder.items.length===0){u.error("No se puede guardar una orden vacía");return}else S.fire({title:"Guardando orden...",didOpen:()=>{S.showLoading()},timer:2e3}),P.post("/Orders",e.currentOrder,e.currentTable,{onSuccess:r=>{u.success("Orden guardada exitosamente"),y("handleOrderSaved",r.props.order),console.log("Order saved successfully:",r.props.order)},onError:r=>{u.error("Error al guardar la orden"),console.error("Error saving order:",r)},finally:()=>{u.info("Save order request completed."),console.log("Save order request completed.")}});h(),console.log("Order saved and reset to empty state:",e.currentOrder)},h=()=>{e.currentOrder.mesa_id=null,e.currentOrder.room_id=null,e.currentOrder.items=[],console.log("Order reset to empty state:",e.currentOrder)},m=b([]),k=b(!1),g=b("all"),N=f(()=>g.value==="all"?m.value.filter(r=>r.is_active):m.value.filter(r=>r.category.name===g.value&&r.is_active)),U=async()=>{try{const r=await H.get(route("products.get"));m.value=r.data.data,k.value=!0,console.log("Products data fetched successfully:",m.value)}catch(r){console.error("There was an error fetching the products data!",r)}},G=(r,t)=>{var i;!e.currentOrder.mesa_id&&!e.currentOrder.room_id&&((i=e.selectedTable)!=null&&i.isRoom?e.currentOrder.room_id=t:e.currentOrder.mesa_id=t);const o=e.currentOrder.items.find(c=>c.product_id===r.id);o?o.quantity+=1:e.currentOrder.items.push({product_id:r.id,quantity:1,price:r.price,product:r}),console.log("========================================="),console.log("Current Order:",e.currentOrder),console.log("Add to Order clicked"),console.log("Product added to order:",r),console.log("Current Order:",e.currentOrder)},M=r=>{const t=e.currentOrder.items.findIndex(o=>o.product_id===r);t!==-1&&(e.currentOrder.items[t].quantity>1?e.currentOrder.items[t].quantity-=1:e.currentOrder.items.splice(t,1)),console.log("Remove from Order clicked"),console.log("Product removed from order:",r),console.log("Current Order:",e.currentOrder)};D(()=>{console.log("Selected Table Prop:",e.selectedTable),e.selectedTable&&(e.selectedTable.isRoom?(e.currentOrder.room_id=e.selectedTable.id||null,e.currentOrder.mesa_id=null):(e.currentOrder.mesa_id=e.selectedTable.id||null,e.currentOrder.room_id=null)),U(),console.log("Component mounted.")}),w(()=>e.selectedTable,r=>{if(console.log("Selected Table changed:",r),!r){e.currentOrder.mesa_id=null,e.currentOrder.room_id=null;return}r.isRoom?(e.currentOrder.room_id=r.id||null,e.currentOrder.mesa_id=null):(e.currentOrder.mesa_id=r.id||null,e.currentOrder.room_id=null)});const $=f(()=>e.currentOrder.items.reduce((r,t)=>r+t.price*t.quantity,0)),z=()=>{var t,o,i,c;const r={mesa_id:(t=e.selectedTable)!=null&&t.isRoom?null:((o=e.selectedTable)==null?void 0:o.id)||e.currentOrder.mesa_id,room_id:(i=e.selectedTable)!=null&&i.isRoom?((c=e.selectedTable)==null?void 0:c.id)||e.currentOrder.room_id:null,status:e.currentOrder.status||"En curso",items:e.currentOrder.items,subtotal:$.value,notes:e.localNotes??null};P.put(`/Order/Update/${e.currentOrder.id}`,r,{onSuccess:p=>{console.log("Payload subtotal sent:",r.subtotal),u.success("Orden actualizada exitosamente"),y("handleOrderUpdated",p.props.order),console.log("Order updated successfully:",p.props.order)},onError:p=>{u.error("Error al actualizar la orden"),console.error("Error updating order:",p)},finally:()=>{u.info("Update order request completed."),console.log("Update order request completed.")}}),h(),console.log("Order updated and reset to empty state:",e.currentOrder)};return console.log(e),(r,t)=>e.selectedTable?(l(),d("div",K,[s("div",V,[t[5]||(t[5]=s("p",{class:"text-center"},"Selecciona una categoría del Menú",-1)),k.value?(l(),d("div",W,[T(s("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>g.value=o),class:"border p-2 rounded-lg w-full mb-4"},[t[2]||(t[2]=s("option",{disabled:"",value:""},"Seleccionar categoría",-1)),t[3]||(t[3]=s("option",{value:"all"},"Todas las categorías",-1)),(l(!0),d(C,null,E([...new Set(m.value.map(o=>o.category.name))],o=>(l(),d("option",{key:o,value:o},v(o),9,X))),128))],512),[[I,g.value]]),T(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=o=>O.value=o),placeholder:"Buscar producto...",class:"border p-2 rounded-lg w-full mb-4"},null,512),[[F,O.value]]),N.value.length>0?(l(),d("div",Y,[t[4]||(t[4]=s("h4",{class:"text-xl font-semibold mb-2"}," Productos Disponibles: ",-1)),s("ul",Z,[(l(!0),d(C,null,E(j.value,o=>{var i;return l(),d("li",{key:o.id,class:"mb-1 flex flex-col"},[s("div",ee,[s("img",{src:o.image,alt:"Product Image",class:"h-40 w-full 2xl:max-w-40 object-cover mb-2"},null,8,re),s("span",te,v(o.name),1),s("span",oe,"$"+v(o.price),1),s("div",se,[!n.isEdit||n.isEdit&&_.value?(l(),d("button",{key:0,class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-red-600/80 text-white hover:bg-red-600",onClick:c=>M(o.id)}," - ",8,le)):a("",!0),n.isEdit&&!_.value?(l(),d("button",de," - ")):a("",!0),s("span",ne,v(((i=n.currentOrder.items.find(c=>c.product_id===o.id))==null?void 0:i.quantity)||0),1),s("button",{class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-approveGreen/80 text-white hover:bg-approveGreen",onClick:c=>G(o,n.selectedTable.id)}," + ",8,ae)])])])}),128))])])):a("",!0)])):a("",!0),s("div",ie,[n.isEdit?a("",!0):(l(),d("button",{key:0,class:"mt-4 px-8 py-2 bg-dangerRed hover:bg-red-800 text-white rounded-lg transition-all duration-300 transform ease-in-out",onClick:B}," Cerrar ")),n.isEdit?a("",!0):(l(),d("button",{key:1,class:"mt-4 px-10 py-2 bg-softBlue hover:bg-blue-800 transition-all transform duration-300 ease-in-out text-white rounded-lg",onClick:R}," Guardar orden ")),n.isEdit?(l(),Q(J,{key:2,class:"mt-4 px-8 py-2 bg-dangerRed hover:bg-red-800 text-white rounded-lg transition-all duration-300 transform ease-in-out"})):a("",!0),n.isEdit?(l(),d("button",{key:3,class:"mt-4 px-10 py-2 bg-softBlue hover:bg-blue-800 transition-all transform duration-300 ease-in-out text-white rounded-lg",onClick:z}," Actualizar orden ")):a("",!0)])])])):a("",!0)}};export{me as default};
