import{y as E,m as f,j as x,g,o as m,b as o,a as L,k as _,p as M,F,q as Q,t as s,w as H,i as X,f as v,z,A as k}from"./app-EJrLyPhB.js";import{_ as Y}from"./Modal-D4wI_Ha7.js";const J={class:"bg-white p-4 rounded-2xl"},K={class:"flex gap-4 justify-between mx-auto"},R={class:"w-full mt-2 border"},W={class:"border p-2 text-center"},Z={class:"border p-2 text-center"},tt={class:"border p-2 text-center"},et={class:"border p-2 text-center"},rt={class:"border p-2 text-center"},ot={class:"border p-2 text-center"},at={class:"border p-2 text-center"},nt={class:"border p-2 text-center"},st={class:"p-8 bg-gradient-to-br from-white via-gray-50 to-gray-200 rounded-2xl shadow-2xl mx-auto"},it={key:0,class:"mb-4"},lt={class:"flex justify-end gap-3 mt-8"},ct={__name:"ListSales",props:{sales:Array},setup(V){const i=V,S=E().props.auth.user;console.log("props in <ListSales>: ",i.sales),console.log("user in <ListSales>: ",S);const p=f(""),G=x(()=>{let r=[...i.sales].sort((t,e)=>e.id-t.id);return p.value?r.filter(t=>new Date(t.date_time).toISOString().split("T")[0]===p.value):r}),d=f(!1),P=()=>{d.value=!0},w=r=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(r),j=(r,t)=>`${r} x ${w(t)}`,A=(r,t)=>w(r*t),l={morning:"Mañana",afternoon:"Tarde"},h=r=>{const t=new Date(r).getHours();return t>=7&&t<15?l.morning:t>=15&&t<23?l.afternoon:"Fuera de turno"},I=x(()=>{const r={};return i.sales.forEach(t=>{const e=new Date(t.date_time).toISOString().split("T")[0],a=h(t.date_time);r[e]||(r[e]={morning:[],afternoon:[],other:[]}),a===l.morning?r[e].morning.push(t):a===l.afternoon?r[e].afternoon.push(t):r[e].other.push(t)}),r});console.log("Sales grouped by day and shift:",I.value);const y=r=>i.sales.filter(t=>h(t.date_time)===r).reduce((t,e)=>t+e.quantity*e.unit_price,0);console.log("Total sales in the morning:",y(l.morning)),console.log("Total sales in the afternoon:",y(l.afternoon)),console.log("Total sales outside shifts:",y("Fuera de turno"));const O=x(()=>i.sales.reduce((r,t)=>r+t.quantity*t.unit_price,0));console.log("Grand total of sales:",O.value);function D(r){const t=new Date(r);return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")+" "+String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0")}const u=f(""),n=f("");function c(){let r=i.sales;if(u.value&&(r=r.filter(t=>new Date(t.date_time).toISOString().split("T")[0]===u.value)),n.value){let t=n.value;t==="Matutino"&&(t="Mañana"),t==="Vespertino"&&(t="Tarde"),t==="Otro"&&(t="Fuera de turno"),r=r.filter(e=>h(e.date_time)===t)}return r}function B(r){return r.length?new Date(Math.min(...r.map(t=>new Date(t.date_time)))):null}function b(r){return r.reduce((t,e)=>t+e.quantity*e.unit_price,0)}function T(r){const t=new Set;let e=0;return r.forEach(a=>{a.order&&!t.has(a.order.id)&&a.order.tip!==null&&a.order.tip!==void 0&&a.order.tip!==""&&(e+=parseFloat(a.order.tip),t.add(a.order.id))}),e}function C(r){return r.reduce((t,e)=>{const a=e.order&&e.order.tip_percent?parseFloat(e.order.tip_percent):0;return t+e.quantity*e.unit_price*(a/100)},0)}function N(){const r=c();if(!r.length)return null;const t=B(r),e=b(r),a=T(r),U=C(r);return{user_id:S.id,start_date:D(t),end_date:D(t),shift:n.value,initial_amount:3500,total_amount:e,final_amount:3500+e,total_tips:a+U}}const q=async()=>{const r=N();if(!r){alert("No hay ventas para la fecha y turno seleccionados.");return}try{const t=await k.post("/CashAudit",r);console.log("Corte de caja guardado:",t.data),alert(`Corte de caja generado y guardado exitosamente.
Propinas: $${r.total_tips.toFixed(2)}`)}catch(t){console.error("Error al guardar el corte de caja:",t),alert("Error al generar y guardar el corte de caja.")}},$=()=>{const r={fecha:u.value,turno:n.value,totalVentas:b(c()),montoFinal:3500+b(c()),totalPropinas:T(c())+C(c())};k.get(route("print.cutOff"),{params:{data:r}}).then(t=>{if(t.data&&t.data.printData){const e="print://"+t.data.printData;window.location.href=e}})};return(r,t)=>(m(),g(F,null,[o("div",J,[o("div",K,[_(o("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e),type:"date",placeholder:"Buscar Ventas por fecha",class:"border p-2 rounded-lg w-full"},null,512),[[M,p.value]]),o("button",{onClick:P,class:"bg-approveGreen hover:bg-green-700 transform *: text-white px-4 py-2 lg:w-96 rounded-md uppercase"}," Generar Corte de Caja ")]),o("table",R,[t[6]||(t[6]=o("thead",null,[o("tr",{class:"bg-gray-100"},[o("th",{class:"p-4"},"#"),o("th",{class:"p-4"},"Fecha de Creación"),o("th",{class:"p-4"},"Orden ID"),o("th",{class:"p-4"},"Usuario"),o("th",{class:"p-4"},"Producto"),o("th",{class:"p-4"},"Subtotal"),o("th",{class:"p-4"},"Total"),o("th",{class:"p-4"},"Método de Pago")])],-1)),o("tbody",null,[(m(!0),g(F,null,Q(G.value,e=>(m(),g("tr",{key:e.id},[o("td",W,s(e.id),1),o("td",Z,s(e.date_time),1),o("td",tt,s(e.order_id),1),o("td",et,s(e.user.name),1),o("td",rt,s(e.product?e.product.name:e.product_id),1),o("td",ot,s(j(e.quantity,e.unit_price)),1),o("td",at,s(A(e.quantity,e.unit_price)),1),o("td",nt,s(e.payment_method),1)]))),128))])])]),L(Y,{show:d.value,"onUpdate:show":t[4]||(t[4]=e=>d.value=e),onClose:t[5]||(t[5]=e=>d.value=!1)},{default:H(()=>[o("div",st,[t[9]||(t[9]=o("h3",{class:"text-2xl font-extrabold text-gray-800 mb-2 flex items-center gap-2"},[o("svg",{class:"w-7 h-7 text-approveGreen",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[o("path",{d:"M12 8v4l3 3"}),o("circle",{cx:"12",cy:"12",r:"10"})]),v(" Generar Corte ")],-1)),t[10]||(t[10]=o("p",{class:"mb-6 text-gray-600 text-base"},[v(" ¿Cuál será el "),o("span",{class:"font-semibold text-approveGreen"},"Turno"),v(" para este corte de caja? ")],-1)),_(o("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.value=e),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-4"},[...t[7]||(t[7]=[o("option",{value:"",disabled:""},"Seleccione un turno",-1),o("option",{value:"Matutino"},"Mañana (7am - 3pm)",-1),o("option",{value:"Vespertino"},"Tarde (3pm - 11pm)",-1)])],512),[[z,n.value]]),n.value==="Matutino"||n.value==="Vespertino"?(m(),g("div",it,[t[8]||(t[8]=o("label",{class:"block text-gray-700 font-medium mb-2"},"Selecciona la fecha",-1)),_(o("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e),type:"date",class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition"},null,512),[[M,u.value]])])):X("",!0),o("div",lt,[o("button",{onClick:t[3]||(t[3]=e=>d.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Cancelar "),o("button",{onClick:$,class:"bg-green-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Imprimir "),o("button",{onClick:q,class:"bg-approveGreen hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition"}," Generar Corte ")])])]),_:1},8,["show"])],64))}};export{ct as default};
