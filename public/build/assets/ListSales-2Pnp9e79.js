import{y as Y,j as z,m as y,g as l,o as i,b as a,a as J,k as x,i as D,p as F,F as g,q as k,t as u,n as K,d as R,s as P,w as W,f as b,A as Z,B as v,S as tt,x as j}from"./app-BsmVB6Bw.js";import{_ as et}from"./Modal-UKDxrgvS.js";const rt={class:"bg-white p-4 rounded-2xl w-full max-w-96 sm:max-w-[40rem] lg:max-w-full mx-auto"},at={class:"flex gap-4 justify-between mx-auto"},ot={class:"overflow-x-auto w-full"},nt={class:"w-full mt-2 border"},st={class:"border p-2 text-center"},lt={class:"border p-2 text-center"},it={class:"border p-2 text-center"},ut={class:"border p-2 text-center"},dt={class:"border p-2 text-center"},ct={class:"border p-2 text-center"},pt={class:"border p-2 text-center"},ft={class:"border p-2 text-center"},gt={class:"mt-4 flex justify-center"},mt=["onClick","innerHTML"],ht=["innerHTML"],yt={class:"p-8 bg-gradient-to-br from-white via-gray-50 to-gray-200 rounded-2xl shadow-2xl mx-auto"},xt={key:0,class:"mb-4"},bt={class:"flex justify-end gap-3 mt-8"},wt={__name:"ListSales",props:{sales:Object},setup(B){const m=B,p=Y().props.auth.user;console.log("user details",p);const G=z(()=>p&&p.permissions&&p.permissions.includes("generate cutoff")),n=y(""),s=y(""),d=y(!1),V=()=>{d.value=!0},h=()=>{d.value=!1},_=r=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(r),A=(r,t)=>`${r} x ${_(t)}`,N=(r,t)=>_(r*t),w={morning:"Mañana",afternoon:"Tarde"},O=r=>{const t=new Date(r).getHours();return t>=7&&t<15?w.morning:t>=15&&t<23?w.afternoon:"Fuera de turno"};function f(){let r=m.sales.data;if(n.value&&(r=r.filter(t=>{const e=new Date(t.date_time);return e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0")===n.value})),s.value){let t=s.value;t==="Matutino"&&(t="Mañana"),t==="Vespertino"&&(t="Tarde"),t==="Otro"&&(t="Fuera de turno"),r=r.filter(e=>O(e.date_time)===t)}return r}function $(r){return r.length?new Date(Math.min(...r.map(t=>new Date(t.date_time)))):null}function c(r){return r.filter(t=>!t.is_courtesy).reduce((t,e)=>t+e.quantity*e.unit_price,0)}function C(r){const t=new Set;let e=0;return r.forEach(o=>{o.order&&!t.has(o.order.id)&&o.order.tip!==null&&o.order.tip!==void 0&&o.order.tip!==""&&(e+=parseFloat(o.order.tip),t.add(o.order.id))}),e}function S(r){return r.reduce((t,e)=>{const o=e.order&&e.order.tip_percent?parseFloat(e.order.tip_percent):0;return t+e.quantity*e.unit_price*(o/100)},0)}function M(r){const t=new Date(r);return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")+" "+String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0")}async function T(){if(!n.value||!s.value)return alert("Por favor, selecciona una fecha y un turno."),null;const{data:r}=await v.get("/Sales-for-cutoff",{params:{date:n.value,shift:s.value}});if(!r.length)return null;const t=$(r),e=c(r),o=C(r),X=S(r);return{user_id:p.id,start_date:M(t),end_date:M(t),shift:s.value,initial_amount:3500,total_amount:e,final_amount:3500+e,total_tips:o+X}}function E(){let r=f();return r=r.filter(t=>t.payment_method==="Efectivo"&&!t.is_courtesy),r}function I(){let r=f();return r=r.filter(t=>t.payment_method==="Tarjeta"&&!t.is_courtesy),r}function L(){let r=f();return r=r.filter(t=>t.is_courtesy===1),r}async function H(){const r=await T();try{const t=await v.post("/CashAudit",r);j().success("Corte de caja Generado Exitosamente"),h(),alert(`Corte de caja generado y guardado exitosamente.
Propinas: $${r.total_tips.toFixed(2)}`)}catch{h(),j().error("Error al generar el corte de caja")}}const U=async()=>{if(!await T()){alert("No hay ventas para la fecha y turno seleccionados.");return}h(),tt.fire({title:"¿Estás seguro?",text:"¡No podrás revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, generar corte",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&H()})},q=()=>{const r=f();if(!r.length){alert("No hay ventas para la fecha y turno seleccionados.");return}const t={fecha:n.value,turno:s.value,totalVentas:c(r),montoFinal:3500+c(r),totalPropinas:C(r)+S(r),totalEfectivo:c(E()),totalTarjeta:c(I()),totalCortesias:c(L())};v.get(route("print.cutOff"),{params:{data:t}}).then(e=>{if(e.data&&e.data.printData){const o="print://"+e.data.printData;window.location.href=o}})};function Q(){console.log("Selected date:",n.value),P.get(route("Sales/Index"),{date:n.value},{preserveState:!0,replace:!0})}return(r,t)=>(i(),l(g,null,[a("div",rt,[a("div",at,[x(a("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),onChange:Q,type:"date",placeholder:"Buscar Ventas por fecha",class:"border p-2 rounded-lg w-full"},null,544),[[F,n.value]]),G.value?(i(),l("button",{key:0,onClick:V,class:"bg-approveGreen hover:bg-green-700 text-white px-4 py-2 lg:w-96 rounded-md uppercase"}," Generar Corte de Caja ")):D("",!0)]),a("div",ot,[a("table",nt,[t[6]||(t[6]=a("thead",null,[a("tr",{class:"bg-gray-100"},[a("th",{class:"p-4"},"#"),a("th",{class:"p-4"},"Fecha de Creación"),a("th",{class:"p-4"},"Orden ID"),a("th",{class:"p-4"},"Usuario"),a("th",{class:"p-4"},"Producto"),a("th",{class:"p-4"},"Subtotal"),a("th",{class:"p-4"},"Total"),a("th",{class:"p-4"},"Método de Pago")])],-1)),a("tbody",null,[(i(!0),l(g,null,k(m.sales.data,e=>(i(),l("tr",{key:e.id},[a("td",st,u(e.id),1),a("td",lt,u(e.date_time),1),a("td",it,u(e.order_id),1),a("td",ut,u(e.user.name),1),a("td",dt,u(e.product?e.product.name:e.product_id),1),a("td",ct,u(A(e.quantity,e.unit_price)),1),a("td",pt,u(N(e.quantity,e.unit_price)),1),a("td",ft,u(e.payment_method),1)]))),128))])])]),a("div",gt,[(i(!0),l(g,null,k(m.sales.links,e=>(i(),l(g,{key:e.label},[e.url?(i(),l("button",{key:0,onClick:o=>R(P).get(e.url,{},{preserveState:!0,replace:!0}),class:K(["px-3 py-1 mx-1 rounded",{"bg-approveGreen text-white":e.active}]),innerHTML:e.label},null,10,mt)):(i(),l("span",{key:1,class:"px-3 py-1 mx-1 text-gray-400",innerHTML:e.label},null,8,ht))],64))),128))])]),J(et,{show:d.value,"onUpdate:show":t[4]||(t[4]=e=>d.value=e),onClose:t[5]||(t[5]=e=>d.value=!1)},{default:W(()=>[a("div",yt,[t[9]||(t[9]=a("h3",{class:"text-2xl font-extrabold text-gray-800 mb-2 flex items-center gap-2"},[a("svg",{class:"w-7 h-7 text-approveGreen",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[a("path",{d:"M12 8v4l3 3"}),a("circle",{cx:"12",cy:"12",r:"10"})]),b(" Generar Corte ")],-1)),t[10]||(t[10]=a("p",{class:"mb-6 text-gray-600 text-base"},[b(" ¿Cuál será el "),a("span",{class:"font-semibold text-approveGreen"},"Turno"),b(" para este corte de caja? ")],-1)),x(a("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.value=e),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-4"},[...t[7]||(t[7]=[a("option",{value:"",disabled:""},"Seleccione un turno",-1),a("option",{value:"Matutino"},"Mañana (7am - 3pm)",-1),a("option",{value:"Vespertino"},"Tarde (3pm - 11pm)",-1)])],512),[[Z,s.value]]),s.value==="Matutino"||s.value==="Vespertino"?(i(),l("div",xt,[t[8]||(t[8]=a("label",{class:"block text-gray-700 font-medium mb-2"},"Selecciona la fecha",-1)),x(a("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.value=e),type:"date",class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition"},null,512),[[F,n.value]])])):D("",!0),a("div",bt,[a("button",{onClick:t[3]||(t[3]=e=>d.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Cancelar "),a("button",{onClick:q,class:"bg-green-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Imprimir "),a("button",{onClick:U,class:"bg-approveGreen hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition"}," Generar Corte ")])])]),_:1},8,["show"])],64))}};export{wt as default};
