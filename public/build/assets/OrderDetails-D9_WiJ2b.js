import{m as x,y as O,g as s,o as n,b as t,i as d,F as h,q as C,f as v,t as y,a as j,w as $,k as w,z as _,p as G,A as M,S as T,s as S}from"./app-BZAdpixh.js";import{_ as q}from"./Modal-Bx_EIeB3.js";const V={class:"bg-white p-6 rounded-lg shadow-md flex overflow-y-auto justify-between max-h-64 hover:scale-[1.02] transition-all transform ease-in-out duration-300"},A={class:"flex flex-col gap-2"},U={key:0,src:"assets/icons/svg/details/utensils.svg",alt:"Food Icon",class:"inline w-5 ml-2 cursor-pointer"},F={key:1,src:"assets/icons/svg/details/drink.svg",alt:"Drink Icon",class:"inline w-5 ml-2 cursor-pointer"},z={key:1,class:"text-gray-400"},J={key:0,class:"h-fit overflow-auto flex flex-col gap-2 items-end"},L={key:0,class:"text-center"},P={key:1,class:"text-gray-400"},H={class:"bg-white p-6 rounded-lg shadow-md flex h-fit justify-between hover:scale-[1.02] transition-all transform ease-in-out duration-300"},R={class:"flex items-center gap-4"},Y={class:"font-bold text-2xl 2xl:text-3xl"},K={class:"p-8 bg-gradient-to-br from-white via-gray-50 to-gray-200 rounded-2xl shadow-2xl mx-auto"},Q={key:0,class:"mb-4"},W={key:0,class:"mt-2"},X={class:"flex justify-end gap-3 mt-8"},te={__name:"OrderDetails",props:{order:Object},setup(l){const r=l,i=x(!1),E=()=>{i.value=!1},b=x("Efectivo"),p=x("0"),m=x(""),u=O().props.auth.user;console.log("order prop in <OrderDetails>: ",r.order);const D=[1,2,3,4,6,7,8,20],B=[5,9,10,11,12,13,14,15,16,17,18,19],I=()=>{E(),T.fire({icon:"info",title:"Estás segur@ de cobrar la orden?",text:"Asegurate primero de haber cobrado el monto correcto.",showCancelButton:!0,confirmButtonText:"Sí, cobrar",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#d33"}).then(g=>{g.isConfirmed&&r.order&&r.order.id&&r.order.order_details&&(S.post(`/Order/AddTip/${r.order.id}`,{tip_percent:p.value?Number(p.value):null,tip:m.value?Number(m.value):null},{onSuccess:()=>{console.log("Tip added successfully")},onError:e=>{console.error("Error adding tip",e)}}),r.order.order_details.forEach(e=>{S.post("/Sales/Create",{order_id:r.order.id,product_id:e.product_id,user_id:u.id,cash_audit_id:null,quantity:e.quantity,unit_price:e.unit_price??(e.product?e.product.price:0),subtotal:e.total??e.quantity*(e.unit_price??(e.product?e.product.price:0)),payment_method:b.value,date_time:new Date().toISOString().slice(0,19).replace("T"," ")},{onSuccess:()=>{console.log("Sale created successfully for product",e.product_id)},onError:c=>{console.error("Error creating sale for product",e.product_id,c)}})}),T.fire({icon:"success",title:"¡Venta creada exitosamente!",showConfirmButton:!1,timer:1500}))})},N=()=>{if(r.order&&r.order.id){const g={total:r.order.total,items:r.order.order_details.length,cash:r.order.total,change:0,user_id:u.name,updated_at:new Date().toISOString().slice(0,19).replace("T"," "),created_at:new Date().toISOString().slice(0,19).replace("T"," "),id:r.order.id,user:{id:u.id,name:u.name,email:u.email,role:u.role}},e=r.order.order_details.map(a=>({price:a.unit_price??(a.product?a.product.price:0),quantity:a.quantity,name:a.product?a.product.name:""})),c={name:"Hotel Ronda Minerva",address:"Av. Adolfo López Mateos Sur 265, Jardines del Bosque, 44520 Guadalajara, Jal.",phone:"33 3121 4700"};M.get("/print-ticket/",{params:{data:{ticketData:g,ticketItems:e,businessInfo:c}}}).then(a=>{if(a.data&&a.data.printData){const f="print://"+a.data.printData;console.clear(),console.log(f),window.location.href=f,console.log("Ticket data sent successfully:",a.data)}else console.error("No print data received from server.")}).catch(a=>{console.error("Error sending ticket data:",a)})}else console.error("No order data available to print ticket.")};return(g,e)=>{var c,a,f,k;return n(),s(h,null,[e[15]||(e[15]=t("h2",{class:"text-lg font-semibold mt-2 mb- text-center text-white"}," Detalles de la orden ",-1)),t("div",V,[t("div",A,[l.order&&l.order.order_details&&l.order.order_details.length?(n(!0),s(h,{key:0},C(l.order.order_details,o=>(n(),s("span",{key:o.id},[o.product&&D.includes(o.product.category_id)?(n(),s("img",U)):o.product&&B.includes(o.product.category_id)?(n(),s("img",F)):d("",!0),v(" "+y(o.quantity)+" x "+y(o.product?o.product.name:""),1)]))),128)):(n(),s("span",z,"No hay detalles para esta orden."))]),l.order&&l.order.order_details&&l.order.order_details.length?(n(),s("div",J,[(n(!0),s(h,null,C(l.order.order_details,o=>(n(),s("div",{key:o.id},[o.product&&o.product.category_id===2?(n(),s("span",L)):d("",!0),v(" $ "+y(o.unit_price),1)]))),128))])):(n(),s("span",P,"No hay detalles para esta orden."))]),((c=l.order)==null?void 0:c.status)==="En curso"?(n(),s("button",{key:0,onClick:e[0]||(e[0]=o=>g.$inertia.get(`/Order/Edit/${l.order.id}`)),class:"bg-orangeYellow hover:bg-yellow-600 transform transition-all duration-300 ease-in-out text-white font-bold py-2 px-4 rounded"}," Editar Orden ")):d("",!0),t("div",H,[e[14]||(e[14]=t("h3",{class:"font-bold text-3xl"},"Total:",-1)),t("div",R,[t("span",Y," $ "+y((a=r.order)!=null&&a.total?r.order.total:"0.00"),1),((f=r.order)==null?void 0:f.status)==="En curso"?(n(),s("button",{key:0,onClick:e[1]||(e[1]=o=>i.value=!0),class:"bg-approveGreen hover:bg-green-900 transition-all transform duration-300 ease-in-out text-white px-4 py-2 rounded-lg"}," Cobrar ")):d("",!0),((k=r.order)==null?void 0:k.status)==="En curso"?(n(),s("button",{key:1,onClick:N,class:"bg-approveGreen hover:bg-green-900 transition-all transform duration-300 ease-in-out text-white px-4 py-2 rounded-lg"}," Imprimir Ticket ")):d("",!0)]),j(q,{show:i.value,"onUpdate:show":e[6]||(e[6]=o=>i.value=o),onClose:e[7]||(e[7]=o=>i.value=!1)},{default:$(()=>[t("div",K,[e[12]||(e[12]=t("h3",{class:"text-2xl font-extrabold text-gray-800 mb-2 flex items-center gap-2"},[t("svg",{class:"w-7 h-7 text-approveGreen",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{d:"M12 8v4l3 3"}),t("circle",{cx:"12",cy:"12",r:"10"})]),v(" Cobrar Orden ")],-1)),e[13]||(e[13]=t("p",{class:"mb-6 text-gray-600 text-base"},[v(" ¿Cuál será el "),t("span",{class:"font-semibold text-approveGreen"},"método de pago"),v(" para esta orden? ")],-1)),w(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>b.value=o),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-4"},[...e[8]||(e[8]=[t("option",{value:"Efectivo"},"Efectivo",-1),t("option",{value:"Tarjeta"},"Tarjeta de Crédito/Débito",-1)])],512),[[_,b.value]]),b.value==="Tarjeta"?(n(),s("div",Q,[e[11]||(e[11]=t("label",{class:"block text-gray-700 font-medium mb-2"},"El cliente gusta dejar propina de:",-1)),w(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>p.value=o),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-2"},[...e[9]||(e[9]=[t("option",{value:"0"},"No dejar propina",-1),t("option",{value:"5"},"5%",-1),t("option",{value:"10"},"10%",-1),t("option",{value:"15"},"15%",-1),t("option",{value:"20"},"20%",-1),t("option",{value:"otherTip"},"Otro",-1)])],512),[[_,p.value]]),p.value==="otherTip"?(n(),s("div",W,[e[10]||(e[10]=t("label",{class:"block text-gray-700 font-medium mb-1"},"Ingrese el monto de propina:",-1)),w(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>m.value=o),type:"number",min:"0",class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition",placeholder:"Monto de propina"},null,512),[[G,m.value]])])):d("",!0)])):d("",!0),t("div",X,[t("button",{onClick:e[5]||(e[5]=o=>i.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Cancelar "),t("button",{onClick:I,class:"bg-approveGreen hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition"}," Sí, Cobrar ")])])]),_:1},8,["show"])])],64)}}};export{te as default};
