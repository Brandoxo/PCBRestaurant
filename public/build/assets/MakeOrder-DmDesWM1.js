import{s as U,m as O,j as y,D as $,g as l,i as d,o as n,b as s,k as z,C as D,F as h,x as k,t as g,c as I,z as M,S as w,q as _}from"./app-CXnACmzc.js";import{_ as N}from"./ReturnButton-Di3s94Xz.js";const R={key:0,class:"w-full px-8"},A={class:"bg-gray-100 p-8 rounded-xl shadow-lg hover:scale-[1.01] transform transition-transform duration-300 ease-in-out"},V={key:0,class:"mt-4"},F=["value"],L={key:0,class:"text-center text-gray-500"},H={class:"list-disc list-inside max-h-48 2xl:max-h-[30rem] overflow-y-auto grid grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4"},J={class:"bg-white rounded shadow flex justify-between items-center flex-col"},K=["src"],Q={class:"font-bold"},W={class:"font-extrabold text-black text-lg mb-"},X={class:"flex justify-evenly w-full m-4 text-center items-center"},Y=["onClick"],Z={key:1,disabled:"",class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-gray-400/80 text-white cursor-not-allowed"},ee={class:"text-lg font-bold text-gray-700"},re=["onClick"],te={class:"flex justify-between mt-6"},ne={__name:"MakeOrder",props:{tables:Object,orders:Object,selectedTable:Object,currentOrder:Object,isEdit:Boolean},emits:["closeOptions"],setup(a,{emit:C}){const e=a,b=C;function E(){b("closeOptions"),p(),console.log("Close Options clicked, order reset to normal state:",e.currentOrder)}const c=U(),S=()=>{if(console.log("Save Order clicked with current order:",e.currentOrder),!e.currentOrder.mesa_id||e.currentOrder.items.length===0){c.error("No se puede guardar una orden vacía");return}else _.post("/Orders",e.currentOrder,e.currentTable,{onSuccess:r=>{c.success("Orden guardada exitosamente"),b("handleOrderSaved",r.props.order),console.log("Order saved successfully:",r.props.order)},onError:r=>{c.error("Error al guardar la orden"),console.error("Error saving order:",r)},finally:()=>{c.info("Save order request completed."),console.log("Save order request completed.")}});p(),console.log("Order saved and reset to empty state:",e.currentOrder)},T=()=>{w.fire({title:"¿Estás seguro?",text:"¡No podrás revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, Generar orden",cancelButtonText:"Cancelar"}).then(r=>{r.isConfirmed&&(S(),w.fire("¡Generada!","La orden ha sido generada.","success"))})},p=()=>{e.currentOrder.mesa_id=null,e.currentOrder.items=[],console.log("Order reset to empty state:",e.currentOrder)},i=O([]),x=O(!1),u=O("all"),v=y(()=>u.value==="all"?i.value.filter(r=>r.is_active):i.value.filter(r=>r.category.name===u.value&&r.is_active)),B=async()=>{try{const r=await M.get(route("products.get"));i.value=r.data.data,x.value=!0,console.log("Products data fetched successfully:",i.value)}catch(r){console.error("There was an error fetching the products data!",r)}},q=(r,o)=>{e.currentOrder.mesa_id||(e.currentOrder.mesa_id=o);const t=e.currentOrder.items.find(m=>m.product_id===r.id);t?t.quantity+=1:e.currentOrder.items.push({product_id:r.id,quantity:1,price:r.price,product:r}),console.log("========================================="),console.log("Current Order:",e.currentOrder),console.log("Add to Order clicked"),console.log("Product added to order:",r),console.log("Current Order:",e.currentOrder)},P=r=>{const o=e.currentOrder.items.findIndex(t=>t.product_id===r);o!==-1&&(e.currentOrder.items[o].quantity>1?e.currentOrder.items[o].quantity-=1:e.currentOrder.items.splice(o,1)),console.log("Remove from Order clicked"),console.log("Product removed from order:",r),console.log("Current Order:",e.currentOrder)};$(()=>{var r;console.log("Selected Table Prop:",e.selectedTable),e.currentOrder.mesa_id=(r=e.selectedTable)!=null&&r.number?e.selectedTable.number:null,B(),console.log("Component mounted.")});const j=y(()=>e.currentOrder.items.reduce((r,o)=>r+o.price*o.quantity,0)),G=()=>{var o;const r={table_id:((o=e.selectedTable)==null?void 0:o.number)||e.currentOrder.table_id,status:e.currentOrder.status||"En curso",items:e.currentOrder.items,subtotal:j.value};_.put(`/Order/Update/${e.currentOrder.id}`,r,{onSuccess:t=>{console.log("Payload subtotal sent:",r.subtotal),c.success("Orden actualizada exitosamente"),b("handleOrderUpdated",t.props.order),console.log("Order updated successfully:",t.props.order)},onError:t=>{c.error("Error al actualizar la orden"),console.error("Error updating order:",t)},finally:()=>{c.info("Update order request completed."),console.log("Update order request completed.")}}),p(),console.log("Order updated and reset to empty state:",e.currentOrder)};return console.log(e),(r,o)=>e.selectedTable?(n(),l("div",R,[s("div",A,[o[4]||(o[4]=s("p",{class:"text-center"},"Selecciona una categoría del Menú",-1)),x.value?(n(),l("div",V,[z(s("select",{"onUpdate:modelValue":o[0]||(o[0]=t=>u.value=t),class:"border p-2 rounded-lg w-full mb-4"},[o[1]||(o[1]=s("option",{disabled:"",value:""},"Seleccionar categoría",-1)),o[2]||(o[2]=s("option",{value:"all"},"Todas las categorías",-1)),(n(!0),l(h,null,k([...new Set(i.value.map(t=>t.category.name))],t=>(n(),l("option",{key:t,value:t},g(t),9,F))),128))],512),[[D,u.value]]),v.value.length>0?(n(),l("div",L,[o[3]||(o[3]=s("h4",{class:"text-xl font-semibold mb-2"}," Productos Disponibles: ",-1)),s("ul",H,[(n(!0),l(h,null,k(v.value,t=>{var m;return n(),l("li",{key:t.id,class:"mb-1 flex flex-col"},[s("div",J,[s("img",{src:t.image,alt:"Product Image",class:"h-40 w-full 2xl:max-w-40 object-cover mb-2"},null,8,K),s("span",Q,g(t.name),1),s("span",W,"$"+g(t.price),1),s("div",X,[a.isEdit?d("",!0):(n(),l("button",{key:0,class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-red-600/80 text-white hover:bg-red-600",onClick:f=>P(t.id)}," - ",8,Y)),a.isEdit?(n(),l("button",Z," - ")):d("",!0),s("span",ee,g(((m=a.currentOrder.items.find(f=>f.product_id===t.id))==null?void 0:m.quantity)||0),1),s("button",{class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-approveGreen/80 text-white hover:bg-approveGreen",onClick:f=>q(t,a.selectedTable.number)}," + ",8,re)])])])}),128))])])):d("",!0)])):d("",!0),s("div",te,[a.isEdit?d("",!0):(n(),l("button",{key:0,class:"mt-4 px-8 py-2 bg-dangerRed hover:bg-red-800 text-white rounded-lg transition-all duration-300 transform ease-in-out",onClick:E}," Cerrar ")),a.isEdit?d("",!0):(n(),l("button",{key:1,class:"mt-4 px-10 py-2 bg-softBlue hover:bg-blue-800 transition-all transform duration-300 ease-in-out text-white rounded-lg",onClick:T}," Guardar orden ")),a.isEdit?(n(),I(N,{key:2,class:"mt-4 px-8 py-2 bg-dangerRed hover:bg-red-800 text-white rounded-lg transition-all duration-300 transform ease-in-out"})):d("",!0),a.isEdit?(n(),l("button",{key:3,class:"mt-4 px-10 py-2 bg-softBlue hover:bg-blue-800 transition-all transform duration-300 ease-in-out text-white rounded-lg",onClick:G}," Actualizar orden ")):d("",!0)])])])):d("",!0)}};export{ne as default};
