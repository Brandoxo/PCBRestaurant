import{m as f,j as x,x as A,y as I,g as n,i as d,o as l,b as s,k as h,A as L,F as w,q as k,t as p,p as N,c as R,B as V,S as _,s as C}from"./app-CwLjmkj5.js";import{_ as z}from"./ReturnButton-XAc-IBve.js";const D={key:0,class:"w-full px-8"},F={class:"bg-gray-100 p-8 rounded-xl shadow-lg hover:scale-[1.01] transform transition-transform duration-300 ease-in-out"},Q={key:0,class:"mt-4"},H=["value"],J={key:0,class:"text-center text-gray-500"},K={class:"list-disc list-inside max-h-96 2xl:max-h-[30rem] overflow-y-auto grid grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4"},W={class:"bg-white rounded shadow flex justify-between items-center flex-col"},X=["src"],Y={class:"font-bold"},Z={class:"font-extrabold text-black text-lg mb-"},ee={class:"flex justify-evenly w-full m-4 text-center items-center"},re=["onClick"],te={key:1,disabled:"",class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-gray-400/80 text-white cursor-not-allowed"},oe={class:"text-lg font-bold text-gray-700"},se=["onClick"],le={class:"flex justify-between mt-6"},de={__name:"MakeOrder",props:{tables:Object,orders:Object,selectedTable:Object,currentOrder:Object,isEdit:Boolean},emits:["closeOptions"],setup(a,{emit:T}){const r=a,m=f(""),E=x(()=>{let e=i.value;return u.value!=="all"?e=e.filter(t=>t.category.name===u.value&&t.is_active):e=e.filter(t=>t.is_active),m.value&&(e=e.filter(t=>t.name.toLowerCase().includes(m.value.toLowerCase().trim()))),e}),b=T;function S(){b("closeOptions"),v(),console.log("Close Options clicked, order reset to normal state:",r.currentOrder)}const c=A(),B=()=>{if(console.log("Save Order clicked with current order:",r.currentOrder),!r.currentOrder.mesa_id||r.currentOrder.items.length===0){c.error("No se puede guardar una orden vacía");return}else C.post("/Orders",r.currentOrder,r.currentTable,{onSuccess:e=>{c.success("Orden guardada exitosamente"),b("handleOrderSaved",e.props.order),console.log("Order saved successfully:",e.props.order)},onError:e=>{c.error("Error al guardar la orden"),console.error("Error saving order:",e)},finally:()=>{c.info("Save order request completed."),console.log("Save order request completed.")}});v(),console.log("Order saved and reset to empty state:",r.currentOrder)},q=()=>{_.fire({title:"¿Estás seguro?",text:"¡No podrás revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, Generar orden",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&(B(),_.fire("¡Generada!","La orden ha sido generada.","success"))})},v=()=>{r.currentOrder.mesa_id=null,r.currentOrder.items=[],console.log("Order reset to empty state:",r.currentOrder)},i=f([]),y=f(!1),u=f("all"),P=x(()=>u.value==="all"?i.value.filter(e=>e.is_active):i.value.filter(e=>e.category.name===u.value&&e.is_active)),j=async()=>{try{const e=await V.get(route("products.get"));i.value=e.data.data,y.value=!0,console.log("Products data fetched successfully:",i.value)}catch(e){console.error("There was an error fetching the products data!",e)}},G=(e,t)=>{r.currentOrder.mesa_id||(r.currentOrder.mesa_id=t);const o=r.currentOrder.items.find(g=>g.product_id===e.id);o?o.quantity+=1:r.currentOrder.items.push({product_id:e.id,quantity:1,price:e.price,product:e}),console.log("========================================="),console.log("Current Order:",r.currentOrder),console.log("Add to Order clicked"),console.log("Product added to order:",e),console.log("Current Order:",r.currentOrder)},U=e=>{const t=r.currentOrder.items.findIndex(o=>o.product_id===e);t!==-1&&(r.currentOrder.items[t].quantity>1?r.currentOrder.items[t].quantity-=1:r.currentOrder.items.splice(t,1)),console.log("Remove from Order clicked"),console.log("Product removed from order:",e),console.log("Current Order:",r.currentOrder)};I(()=>{var e;console.log("Selected Table Prop:",r.selectedTable),r.currentOrder.mesa_id=(e=r.selectedTable)!=null&&e.id?r.selectedTable.id:null,j(),console.log("Component mounted.")});const M=x(()=>r.currentOrder.items.reduce((e,t)=>e+t.price*t.quantity,0)),$=()=>{var t;const e={table_id:((t=r.selectedTable)==null?void 0:t.number)||r.currentOrder.table_id,status:r.currentOrder.status||"En curso",items:r.currentOrder.items,subtotal:M.value};C.put(`/Order/Update/${r.currentOrder.id}`,e,{onSuccess:o=>{console.log("Payload subtotal sent:",e.subtotal),c.success("Orden actualizada exitosamente"),b("handleOrderUpdated",o.props.order),console.log("Order updated successfully:",o.props.order)},onError:o=>{c.error("Error al actualizar la orden"),console.error("Error updating order:",o)},finally:()=>{c.info("Update order request completed."),console.log("Update order request completed.")}}),v(),console.log("Order updated and reset to empty state:",r.currentOrder)};return console.log(r),(e,t)=>r.selectedTable?(l(),n("div",D,[s("div",F,[t[5]||(t[5]=s("p",{class:"text-center"},"Selecciona una categoría del Menú",-1)),y.value?(l(),n("div",Q,[h(s("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>u.value=o),class:"border p-2 rounded-lg w-full mb-4"},[t[2]||(t[2]=s("option",{disabled:"",value:""},"Seleccionar categoría",-1)),t[3]||(t[3]=s("option",{value:"all"},"Todas las categorías",-1)),(l(!0),n(w,null,k([...new Set(i.value.map(o=>o.category.name))],o=>(l(),n("option",{key:o,value:o},p(o),9,H))),128))],512),[[L,u.value]]),h(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=o=>m.value=o),placeholder:"Buscar producto...",class:"border p-2 rounded-lg w-full mb-4"},null,512),[[N,m.value]]),P.value.length>0?(l(),n("div",J,[t[4]||(t[4]=s("h4",{class:"text-xl font-semibold mb-2"}," Productos Disponibles: ",-1)),s("ul",K,[(l(!0),n(w,null,k(E.value,o=>{var g;return l(),n("li",{key:o.id,class:"mb-1 flex flex-col"},[s("div",W,[s("img",{src:o.image,alt:"Product Image",class:"h-40 w-full 2xl:max-w-40 object-cover mb-2"},null,8,X),s("span",Y,p(o.name),1),s("span",Z,"$"+p(o.price),1),s("div",ee,[a.isEdit?d("",!0):(l(),n("button",{key:0,class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-red-600/80 text-white hover:bg-red-600",onClick:O=>U(o.id)}," - ",8,re)),a.isEdit?(l(),n("button",te," - ")):d("",!0),s("span",oe,p(((g=a.currentOrder.items.find(O=>O.product_id===o.id))==null?void 0:g.quantity)||0),1),s("button",{class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-approveGreen/80 text-white hover:bg-approveGreen",onClick:O=>G(o,a.selectedTable.id)}," + ",8,se)])])])}),128))])])):d("",!0)])):d("",!0),s("div",le,[a.isEdit?d("",!0):(l(),n("button",{key:0,class:"mt-4 px-8 py-2 bg-dangerRed hover:bg-red-800 text-white rounded-lg transition-all duration-300 transform ease-in-out",onClick:S}," Cerrar ")),a.isEdit?d("",!0):(l(),n("button",{key:1,class:"mt-4 px-10 py-2 bg-softBlue hover:bg-blue-800 transition-all transform duration-300 ease-in-out text-white rounded-lg",onClick:q}," Guardar orden ")),a.isEdit?(l(),R(z,{key:2,class:"mt-4 px-8 py-2 bg-dangerRed hover:bg-red-800 text-white rounded-lg transition-all duration-300 transform ease-in-out"})):d("",!0),a.isEdit?(l(),n("button",{key:3,class:"mt-4 px-10 py-2 bg-softBlue hover:bg-blue-800 transition-all transform duration-300 ease-in-out text-white rounded-lg",onClick:$}," Actualizar orden ")):d("",!0)])])])):d("",!0)}};export{de as default};
