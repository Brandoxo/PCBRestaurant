import{r as b,z as L,g as a,o as s,b as t,i as d,a as O,F as D,s as R,f as u,t as f,d as g,k,v as Y,w as z,B as V,q as J,C as W,S as _,x as S}from"./app-DmJCh1b2.js";import{_ as K}from"./Modal-CZNQfNsT.js";import{S as Q}from"./Switch-DfR-ttdy.js";import{f as X,a as B}from"./currencyFormatter-WI6XgGo9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"bg-white p-6 rounded-lg shadow-md flex overflow-y-auto justify-between lg:max-h-32 2xl:max-h-64 hover:scale-[1.02] transition-all transform ease-in-out duration-300"},ee={class:"flex flex-col gap-2"},te={key:0,src:"assets/icons/svg/details/utensils.svg",alt:"Food Icon",class:"inline w-5 ml-2 cursor-pointer"},oe={key:1,src:"assets/icons/svg/details/drink.svg",alt:"Drink Icon",class:"inline w-5 ml-2 cursor-pointer"},re={key:1,class:"text-gray-400"},ae={key:0,class:"h-fit overflow-auto flex flex-col gap-2 items-end"},se={key:0,class:"text-center"},ne={key:1,class:"text-gray-400"},le={class:"flex gap-2"},ie={class:"bg-white p-6 rounded-lg shadow-md flex h-fit w-full justify-between hover:scale-[1.02] transition-all transform ease-in-out duration-300 items-center"},de={class:"flex items-center gap-4"},ue={key:0,class:"font-bold text-2xl 2xl:text-3xl"},ce={key:1,class:"flex"},pe={class:"font-bold text-2xl 2xl:text-3xl text-black"},fe={key:0,class:"bg-white p-4 rounded-lg shadow-md hover:scale-[1.02] transition-all transform ease-in-out duration-300 flex-col text-center"},ge={class:"inline-flex items-center cursor-pointer flex-col gap-1 font-bold"},ve={key:1,class:"bg-white p-2 rounded-lg text-center shadow-md hover:scale-[1.02] transition-all transform ease-in-out duration-300 text-red-400 font-extrabold"},me={key:0,class:"bg-gradient-to-br from-white via-gray-50 to-gray-200 p-4 rounded-2xl shadow-2xl mx-auto"},xe={class:"flex justify-end gap-3 mt-8"},be={key:1,class:"p-8 bg-gradient-to-br from-white via-gray-50 to-gray-200 rounded-2xl shadow-2xl mx-auto"},ye={key:0,class:"mb-4"},we={key:0,class:"mt-2"},he={class:"flex justify-end gap-3 mt-8"},F=100,Be={__name:"OrderDetails",props:{order:Object,RoomServiceConfig:Object},setup(n){const o=n,c=b(!1),T=()=>{c.value=!1},y=b("Efectivo"),m=b("0"),w=b(""),p=L().props.auth.user,h=b(!1);console.log("order prop in <OrderDetails>: ",o.order);const I=[1,2,3,4,6,7,8,20],U=[5,9,10,11,12,13,14,15,16,17,18,19],x=o.RoomServiceConfig&&o.RoomServiceConfig.is_active===1,E=x&&o.RoomServiceConfig.service_cost?o.RoomServiceConfig.service_cost:0,M=i=>{if(x){i=parseFloat(i);const e=i*E/100;return i+e}return i};console.log(`Service cost for $${F}: $${M(F)}`);const A=async()=>{T(),(await _.fire({icon:"info",title:"Estás segur@ de cobrar la orden?",text:"Asegurate primero de haber cobrado el monto correcto.",showCancelButton:!0,confirmButtonText:"Sí, cobrar",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#d33"})).isConfirmed&&o.order&&o.order.id&&o.order.order_details&&(await S.post(`/Order/AddTip/${o.order.id}`,{tip_percent:m.value?Number(m.value):null,tip:w.value?Number(w.value):null}),await S.post("/Sales/Create",{order_id:o.order.id,user_id:p.id,cash_audit_id:null,payment_method:y.value,sales:o.order.order_details.map(e=>({product_id:e.product_id,quantity:e.quantity,unit_price:e.unit_price??(e.product?e.product.price:0),subtotal:e.total??e.quantity*(e.unit_price??(e.product?e.product.price:0)),is_courtesy:h.value?1:0,is_room:x&&o.order.room_id?1:0}))}),_.fire({icon:"success",title:"¡Venta creada exitosamente!",showConfirmButton:!1,timer:1500}))},P=async()=>{T(),(await _.fire({icon:"info",title:"Estás segur@ de crear una cortesía?",text:"Asegurate primero de haber revisado la orden.",showCancelButton:!0,confirmButtonText:"Sí, crear cortesía",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#d33"})).isConfirmed&&o.order&&o.order.id&&o.order.order_details&&(await S.post("/Sales/Create",{order_id:o.order.id,user_id:p.id,cash_audit_id:null,payment_method:"Cortesía",sales:o.order.order_details.map(e=>({product_id:e.product_id,quantity:e.quantity,unit_price:e.unit_price??(e.product?e.product.price:0),subtotal:e.total??e.quantity*(e.unit_price??(e.product?e.product.price:0)),is_courtesy:1}))}),_.fire({icon:"success",title:"¡Cortesía creada exitosamente!",showConfirmButton:!1,timer:1500}))},H=()=>{if(o.order&&o.order.id){const i={total:o.order.total,items:o.order.order_details.length,cash:o.order.total,change:0,user_id:p.name,updated_at:new Date().getFullYear()+"-"+(new Date().getMonth()+1)+"-"+new Date().getDate()+" "+new Date().getHours()+":"+new Date().getMinutes(),created_at:new Date().getFullYear()+"-"+(new Date().getMonth()+1)+"-"+new Date().getDate()+" "+new Date().getHours()+":"+new Date().getMinutes(),id:o.order.id,user:{id:p.id,name:p.name,email:p.email,role:p.role},table:o.order.table?o.order.table.number:o.order.room_id?o.order.room.prefix+o.order.room.number:0},e=o.order.order_details.map(l=>({price:l.unit_price??(l.product?l.product.price:0),quantity:l.quantity,name:l.product?l.product.name:""})),C={name:"Hotel Ronda Minerva",address:"Av. Adolfo López Mateos Sur 265, Jardines del Bosque, 44520 Guadalajara, Jal.",phone:"33 3121 4700"};W.get("/print-ticket/",{params:{data:{ticketData:i,ticketItems:e,businessInfo:C}}}).then(l=>{if(l.data&&l.data.printData){const v="print://"+l.data.printData;console.clear(),console.log(v),console.log("Print URL:",v),window.location.href=v,console.log("Ticket data sent successfully:",l.data)}else console.error("No print data received from server.")}).catch(l=>{console.error("Error sending ticket data:",l)})}else console.error("No order data available to print ticket.")};return(i,e)=>{var C,l,v,$,j,G,q,N;return s(),a(D,null,[e[21]||(e[21]=t("h2",{class:"text-lg font-semibold text-center text-white"}," Detalles de la orden ",-1)),t("div",Z,[t("div",ee,[n.order&&n.order.order_details&&n.order.order_details.length?(s(!0),a(D,{key:0},R(n.order.order_details,r=>(s(),a("span",{key:r.id},[r.product&&I.includes(r.product.category_id)?(s(),a("img",te)):r.product&&U.includes(r.product.category_id)?(s(),a("img",oe)):d("",!0),u(" "+f(r.quantity)+" x "+f(r.product?r.product.name:""),1)]))),128)):(s(),a("span",re,"No hay detalles para esta orden."))]),n.order&&n.order.order_details&&n.order.order_details.length?(s(),a("div",ae,[(s(!0),a(D,null,R(n.order.order_details,r=>(s(),a("div",{key:r.id},[r.product&&r.product.category_id===2?(s(),a("span",se)):d("",!0),u(" $"+f(g(X).format(r.unit_price)),1)]))),128))])):(s(),a("span",ne,"No hay detalles para esta orden."))]),((C=n.order)==null?void 0:C.status)==="En curso"?(s(),a("button",{key:0,onClick:e[0]||(e[0]=r=>i.$inertia.get(`/Order/Edit/${n.order.id}`)),class:"bg-orangeYellow hover:bg-yellow-600 transform transition-all duration-300 ease-in-out text-white py-2 px-4 rounded uppercase text-sm font-extrabold"}," Editar Orden ")):d("",!0),t("div",le,[t("div",ie,[e[10]||(e[10]=t("h3",{class:"font-bold text-3xl mr-2"},"Total:",-1)),t("div",de,[(l=n.order)!=null&&l.mesa_id?(s(),a("span",ue,f(g(B).format(n.order.total)),1)):g(x)&&((v=n.order)!=null&&v.room_id)?(s(),a("div",ce,[t("span",pe,f(g(B).format(M(n.order.total))),1)])):d("",!0),(($=o.order)==null?void 0:$.status)==="En curso"?(s(),a("button",{key:2,onClick:e[1]||(e[1]=r=>c.value=!0),class:"bg-approveGreen hover:bg-green-900 transition-all transform duration-300 ease-in-out text-white px-4 py-2 rounded-lg uppercase text-sm font-extrabold"}," Cobrar ")):d("",!0)])]),((j=n.order)==null?void 0:j.status)==="En curso"?(s(),a("div",fe,[t("label",ge,[e[11]||(e[11]=u(" ¿Cortesía? ",-1)),k(t("input",{type:"checkbox",class:"sr-only peer","onUpdate:modelValue":e[2]||(e[2]=r=>h.value=r),id:"is_active"},null,512),[[Y,h.value]]),O(Q)])])):d("",!0)]),g(x)&&((G=n.order)!=null&&G.room_id)?(s(),a("div",ve,[e[12]||(e[12]=t("span",null,"(Room Service añadido). ",-1)),t("span",null,f(g(B).format((q=n.order)==null?void 0:q.total))+" + "+f(g(E)|i.withoutFraction)+"% ",1)])):d("",!0),(N=o.order)!=null&&N.status?(s(),a("button",{key:2,onClick:H,class:"bg-approveGreen hover:bg-green-900 transition-all transform duration-300 ease-in-out text-white px-2 py-2 uppercase font-extrabold rounded-lg text-sm"}," Imprimir Ticket ")):d("",!0),O(K,{show:c.value,"onUpdate:show":e[8]||(e[8]=r=>c.value=r),onClose:e[9]||(e[9]=r=>c.value=!1)},{default:z(()=>[h.value===!0?(s(),a("div",me,[e[13]||(e[13]=t("h2",{class:"text-2xl font-extrabold text-gray-800 mb-2 flex items-center gap-2"},[t("svg",{class:"w-7 h-7 text-approveGreen",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{d:"M12 8v4l3 3"}),t("circle",{cx:"12",cy:"12",r:"10"})]),u(" Crear Cortesía ")],-1)),e[14]||(e[14]=t("p",{class:"mb-6 text-gray-600 text-base"},[u(" ¿Estás seguro de "),t("span",{class:"font-semibold text-approveGreen"},"crear cortesía"),u(" para esta orden? ")],-1)),t("div",xe,[t("button",{onClick:e[3]||(e[3]=r=>c.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Cancelar "),t("button",{onClick:P,class:"bg-approveGreen hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition"}," Sí, Crear Cortesía ")])])):(s(),a("div",be,[e[19]||(e[19]=t("h3",{class:"text-2xl font-extrabold text-gray-800 mb-2 flex items-center gap-2"},[t("svg",{class:"w-7 h-7 text-approveGreen",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{d:"M12 8v4l3 3"}),t("circle",{cx:"12",cy:"12",r:"10"})]),u(" Cobrar Orden ")],-1)),e[20]||(e[20]=t("p",{class:"mb-6 text-gray-600 text-base"},[u(" ¿Cuál será el "),t("span",{class:"font-semibold text-approveGreen"},"método de pago"),u(" para esta orden? ")],-1)),k(t("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>y.value=r),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-4"},[...e[15]||(e[15]=[t("option",{value:"Efectivo"},"Efectivo",-1),t("option",{value:"Tarjeta"},"Tarjeta de Crédito/Débito",-1)])],512),[[V,y.value]]),y.value==="Tarjeta"?(s(),a("div",ye,[e[18]||(e[18]=t("label",{class:"block text-gray-700 font-medium mb-2"},"El cliente gusta dejar propina de:",-1)),k(t("select",{"onUpdate:modelValue":e[5]||(e[5]=r=>m.value=r),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-2"},[...e[16]||(e[16]=[t("option",{value:"0"},"No dejar propina",-1),t("option",{value:"5"},"5%",-1),t("option",{value:"10"},"10%",-1),t("option",{value:"15"},"15%",-1),t("option",{value:"20"},"20%",-1),t("option",{value:"otherTip"},"Otro",-1)])],512),[[V,m.value]]),m.value==="otherTip"?(s(),a("div",we,[e[17]||(e[17]=t("label",{class:"block text-gray-700 font-medium mb-1"},"Ingrese el monto de propina:",-1)),k(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>w.value=r),type:"number",min:"0",class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition",placeholder:"Monto de propina"},null,512),[[J,w.value]])])):d("",!0)])):d("",!0),t("div",he,[t("button",{onClick:e[7]||(e[7]=r=>c.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Cancelar "),t("button",{onClick:A,class:"bg-approveGreen hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition"}," Sí, Cobrar ")])]))]),_:1},8,["show"])],64)}}};export{Be as default};
