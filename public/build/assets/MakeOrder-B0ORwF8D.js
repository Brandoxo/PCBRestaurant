import{z as L,j as f,r as p,y as N,l as R,g as n,i as d,o as l,b as s,k,B as V,F as _,s as C,t as v,q as A,c as D,C as F,S as E,x as T}from"./app-DMZtkmGL.js";import{_ as Q}from"./ReturnButton-Cii7yfjp.js";const H={key:0,class:"w-full px-8"},J={class:"bg-gray-100 p-8 rounded-xl shadow-lg hover:scale-[1.01] transform transition-transform duration-300 ease-in-out mt-4 lg:mt-0"},K={key:0,class:"mt-4"},W=["value"],X={key:0,class:"text-center text-gray-500"},Y={class:"list-disc list-inside max-h-96 2xl:max-h-[30rem] overflow-y-auto grid grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4"},Z={class:"bg-white rounded shadow flex justify-between items-center flex-col"},ee=["src"],re={class:"font-bold"},te={class:"font-extrabold text-black text-lg mb-"},oe={class:"flex justify-evenly w-full m-4 text-center items-center"},se=["onClick"],le={key:1,disabled:"",class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-gray-400/80 text-white cursor-not-allowed"},ne={class:"text-lg font-bold text-gray-700"},ae=["onClick"],de={class:"flex justify-between mt-6"},ue={__name:"MakeOrder",props:{tables:Object,orders:Object,selectedTable:Object,currentOrder:Object,isEdit:Boolean},emits:["closeOptions"],setup(a,{emit:S}){const r=a,b=L().props.auth.user,h=f(()=>b&&b.permissions&&b.permissions.includes("edit orders")),m=p(""),B=f(()=>{let e=c.value;return u.value!=="all"?e=e.filter(t=>t.category.name===u.value&&t.is_active):e=e.filter(t=>t.is_active),m.value&&(e=e.filter(t=>t.name.toLowerCase().includes(m.value.toLowerCase().trim()))),e}),O=S;function P(){O("closeOptions"),x(),console.log("Close Options clicked, order reset to normal state:",r.currentOrder)}const i=N(),q=()=>{if(console.log("Save Order clicked with current order:",r.currentOrder),!r.currentOrder.mesa_id||r.currentOrder.items.length===0){i.error("No se puede guardar una orden vacía");return}else T.post("/Orders",r.currentOrder,r.currentTable,{onSuccess:e=>{i.success("Orden guardada exitosamente"),O("handleOrderSaved",e.props.order),console.log("Order saved successfully:",e.props.order)},onError:e=>{i.error("Error al guardar la orden"),console.error("Error saving order:",e)},finally:()=>{i.info("Save order request completed."),console.log("Save order request completed.")}});x(),console.log("Order saved and reset to empty state:",r.currentOrder)},j=()=>{E.fire({title:"¿Estás seguro?",text:"¡No podrás revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, Generar orden",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&(q(),E.fire("¡Generada!","La orden ha sido generada.","success"))})},x=()=>{r.currentOrder.mesa_id=null,r.currentOrder.items=[],console.log("Order reset to empty state:",r.currentOrder)},c=p([]),w=p(!1),u=p("all"),G=f(()=>u.value==="all"?c.value.filter(e=>e.is_active):c.value.filter(e=>e.category.name===u.value&&e.is_active)),U=async()=>{try{const e=await F.get(route("products.get"));c.value=e.data.data,w.value=!0,console.log("Products data fetched successfully:",c.value)}catch(e){console.error("There was an error fetching the products data!",e)}},M=(e,t)=>{r.currentOrder.mesa_id||(r.currentOrder.mesa_id=t);const o=r.currentOrder.items.find(g=>g.product_id===e.id);o?o.quantity+=1:r.currentOrder.items.push({product_id:e.id,quantity:1,price:e.price,product:e}),console.log("========================================="),console.log("Current Order:",r.currentOrder),console.log("Add to Order clicked"),console.log("Product added to order:",e),console.log("Current Order:",r.currentOrder)},$=e=>{const t=r.currentOrder.items.findIndex(o=>o.product_id===e);t!==-1&&(r.currentOrder.items[t].quantity>1?r.currentOrder.items[t].quantity-=1:r.currentOrder.items.splice(t,1)),console.log("Remove from Order clicked"),console.log("Product removed from order:",e),console.log("Current Order:",r.currentOrder)};R(()=>{var e;console.log("Selected Table Prop:",r.selectedTable),r.currentOrder.mesa_id=(e=r.selectedTable)!=null&&e.id?r.selectedTable.id:null,U(),console.log("Component mounted.")});const z=f(()=>r.currentOrder.items.reduce((e,t)=>e+t.price*t.quantity,0)),I=()=>{var t;const e={table_id:((t=r.selectedTable)==null?void 0:t.number)||r.currentOrder.table_id,status:r.currentOrder.status||"En curso",items:r.currentOrder.items,subtotal:z.value};T.put(`/Order/Update/${r.currentOrder.id}`,e,{onSuccess:o=>{console.log("Payload subtotal sent:",e.subtotal),i.success("Orden actualizada exitosamente"),O("handleOrderUpdated",o.props.order),console.log("Order updated successfully:",o.props.order)},onError:o=>{i.error("Error al actualizar la orden"),console.error("Error updating order:",o)},finally:()=>{i.info("Update order request completed."),console.log("Update order request completed.")}}),x(),console.log("Order updated and reset to empty state:",r.currentOrder)};return console.log(r),(e,t)=>r.selectedTable?(l(),n("div",H,[s("div",J,[t[5]||(t[5]=s("p",{class:"text-center"},"Selecciona una categoría del Menú",-1)),w.value?(l(),n("div",K,[k(s("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>u.value=o),class:"border p-2 rounded-lg w-full mb-4"},[t[2]||(t[2]=s("option",{disabled:"",value:""},"Seleccionar categoría",-1)),t[3]||(t[3]=s("option",{value:"all"},"Todas las categorías",-1)),(l(!0),n(_,null,C([...new Set(c.value.map(o=>o.category.name))],o=>(l(),n("option",{key:o,value:o},v(o),9,W))),128))],512),[[V,u.value]]),k(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=o=>m.value=o),placeholder:"Buscar producto...",class:"border p-2 rounded-lg w-full mb-4"},null,512),[[A,m.value]]),G.value.length>0?(l(),n("div",X,[t[4]||(t[4]=s("h4",{class:"text-xl font-semibold mb-2"}," Productos Disponibles: ",-1)),s("ul",Y,[(l(!0),n(_,null,C(B.value,o=>{var g;return l(),n("li",{key:o.id,class:"mb-1 flex flex-col"},[s("div",Z,[s("img",{src:o.image,alt:"Product Image",class:"h-40 w-full 2xl:max-w-40 object-cover mb-2"},null,8,ee),s("span",re,v(o.name),1),s("span",te,"$"+v(o.price),1),s("div",oe,[!a.isEdit||a.isEdit&&h.value?(l(),n("button",{key:0,class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-red-600/80 text-white hover:bg-red-600",onClick:y=>$(o.id)}," - ",8,se)):d("",!0),a.isEdit&&!h.value?(l(),n("button",le," - ")):d("",!0),s("span",ne,v(((g=a.currentOrder.items.find(y=>y.product_id===o.id))==null?void 0:g.quantity)||0),1),s("button",{class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-approveGreen/80 text-white hover:bg-approveGreen",onClick:y=>M(o,a.selectedTable.id)}," + ",8,ae)])])])}),128))])])):d("",!0)])):d("",!0),s("div",de,[a.isEdit?d("",!0):(l(),n("button",{key:0,class:"mt-4 px-8 py-2 bg-dangerRed hover:bg-red-800 text-white rounded-lg transition-all duration-300 transform ease-in-out",onClick:P}," Cerrar ")),a.isEdit?d("",!0):(l(),n("button",{key:1,class:"mt-4 px-10 py-2 bg-softBlue hover:bg-blue-800 transition-all transform duration-300 ease-in-out text-white rounded-lg",onClick:j}," Guardar orden ")),a.isEdit?(l(),D(Q,{key:2,class:"mt-4 px-8 py-2 bg-dangerRed hover:bg-red-800 text-white rounded-lg transition-all duration-300 transform ease-in-out"})):d("",!0),a.isEdit?(l(),n("button",{key:3,class:"mt-4 px-10 py-2 bg-softBlue hover:bg-blue-800 transition-all transform duration-300 ease-in-out text-white rounded-lg",onClick:I}," Actualizar orden ")):d("",!0)])])])):d("",!0)}};export{ue as default};
