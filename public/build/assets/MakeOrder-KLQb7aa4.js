import{z as L,j as p,r as b,y as N,l as D,A as I,g as d,i as a,o as l,b as s,k as w,B as F,F as T,s as C,t as v,q as Q,c as H,C as J,S as E,x as S}from"./app-DcKmE1-1.js";import{_ as K}from"./ReturnButton-hrAUGSRL.js";const V={key:0,class:"w-full px-8"},W={class:"bg-gray-100 p-8 rounded-xl shadow-lg hover:scale-[1.01] transform transition-transform duration-300 ease-in-out mt-4 lg:mt-0"},X={key:0,class:"mt-4"},Y=["value"],Z={key:0,class:"text-center text-gray-500"},ee={class:"list-disc list-inside max-h-96 2xl:max-h-[30rem] overflow-y-auto grid grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4"},re={class:"bg-white rounded shadow flex justify-between items-center flex-col"},te=["src"],oe={class:"font-bold"},se={class:"font-extrabold text-black text-lg mb-"},le={class:"flex justify-evenly w-full m-4 text-center items-center"},de=["onClick"],ne={key:1,disabled:"",class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-gray-400/80 text-white cursor-not-allowed"},ae={class:"text-lg font-bold text-gray-700"},ie=["onClick"],ce={class:"flex justify-between mt-6"},ge={__name:"MakeOrder",props:{tables:Object,orders:Object,selectedTable:Object,currentOrder:Object,isEdit:Boolean},emits:["closeOptions"],setup(n,{emit:B}){const e=n,x=L().props.auth.user,_=p(()=>x&&x.permissions&&x.permissions.includes("edit orders")),f=b(""),P=p(()=>{let r=m.value;return g.value!=="all"?r=r.filter(t=>t.category.name===g.value&&t.is_active):r=r.filter(t=>t.is_active),f.value&&(r=r.filter(t=>t.name.toLowerCase().includes(f.value.toLowerCase().trim()))),r}),y=B;function q(){y("closeOptions"),h(),console.log("Close Options clicked, order reset to normal state:",e.currentOrder)}const u=N(),j=()=>{if(console.log("Save Order clicked with current order:",e.currentOrder),!e.currentOrder.mesa_id&&!e.currentOrder.room_id||e.currentOrder.items.length===0){u.error("No se puede guardar una orden vacía");return}else S.post("/Orders",e.currentOrder,e.currentTable,{onSuccess:r=>{u.success("Orden guardada exitosamente"),y("handleOrderSaved",r.props.order),console.log("Order saved successfully:",r.props.order)},onError:r=>{u.error("Error al guardar la orden"),console.error("Error saving order:",r)},finally:()=>{u.info("Save order request completed."),console.log("Save order request completed.")}});h(),console.log("Order saved and reset to empty state:",e.currentOrder)},R=()=>{E.fire({title:"¿Estás seguro?",text:"¡No podrás revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, Generar orden",cancelButtonText:"Cancelar"}).then(r=>{r.isConfirmed&&(j(),E.fire("¡Generada!","La orden ha sido generada.","success"))})},h=()=>{e.currentOrder.mesa_id=null,e.currentOrder.room_id=null,e.currentOrder.items=[],console.log("Order reset to empty state:",e.currentOrder)},m=b([]),k=b(!1),g=b("all"),G=p(()=>g.value==="all"?m.value.filter(r=>r.is_active):m.value.filter(r=>r.category.name===g.value&&r.is_active)),U=async()=>{try{const r=await J.get(route("products.get"));m.value=r.data.data,k.value=!0,console.log("Products data fetched successfully:",m.value)}catch(r){console.error("There was an error fetching the products data!",r)}},M=(r,t)=>{var i;!e.currentOrder.mesa_id&&!e.currentOrder.room_id&&((i=e.selectedTable)!=null&&i.isRoom?e.currentOrder.room_id=t:e.currentOrder.mesa_id=t);const o=e.currentOrder.items.find(c=>c.product_id===r.id);o?o.quantity+=1:e.currentOrder.items.push({product_id:r.id,quantity:1,price:r.price,product:r}),console.log("========================================="),console.log("Current Order:",e.currentOrder),console.log("Add to Order clicked"),console.log("Product added to order:",r),console.log("Current Order:",e.currentOrder)},$=r=>{const t=e.currentOrder.items.findIndex(o=>o.product_id===r);t!==-1&&(e.currentOrder.items[t].quantity>1?e.currentOrder.items[t].quantity-=1:e.currentOrder.items.splice(t,1)),console.log("Remove from Order clicked"),console.log("Product removed from order:",r),console.log("Current Order:",e.currentOrder)};D(()=>{console.log("Selected Table Prop:",e.selectedTable),e.selectedTable&&(e.selectedTable.isRoom?(e.currentOrder.room_id=e.selectedTable.id||null,e.currentOrder.mesa_id=null):(e.currentOrder.mesa_id=e.selectedTable.id||null,e.currentOrder.room_id=null)),U(),console.log("Component mounted.")}),I(()=>e.selectedTable,r=>{if(console.log("Selected Table changed:",r),!r){e.currentOrder.mesa_id=null,e.currentOrder.room_id=null;return}r.isRoom?(e.currentOrder.room_id=r.id||null,e.currentOrder.mesa_id=null):(e.currentOrder.mesa_id=r.id||null,e.currentOrder.room_id=null)});const z=p(()=>e.currentOrder.items.reduce((r,t)=>r+t.price*t.quantity,0)),A=()=>{var t,o,i,c;const r={mesa_id:(t=e.selectedTable)!=null&&t.isRoom?null:((o=e.selectedTable)==null?void 0:o.id)||e.currentOrder.mesa_id,room_id:(i=e.selectedTable)!=null&&i.isRoom?((c=e.selectedTable)==null?void 0:c.id)||e.currentOrder.room_id:null,status:e.currentOrder.status||"En curso",items:e.currentOrder.items,subtotal:z.value};S.put(`/Order/Update/${e.currentOrder.id}`,r,{onSuccess:O=>{console.log("Payload subtotal sent:",r.subtotal),u.success("Orden actualizada exitosamente"),y("handleOrderUpdated",O.props.order),console.log("Order updated successfully:",O.props.order)},onError:O=>{u.error("Error al actualizar la orden"),console.error("Error updating order:",O)},finally:()=>{u.info("Update order request completed."),console.log("Update order request completed.")}}),h(),console.log("Order updated and reset to empty state:",e.currentOrder)};return console.log(e),(r,t)=>e.selectedTable?(l(),d("div",V,[s("div",W,[t[5]||(t[5]=s("p",{class:"text-center"},"Selecciona una categoría del Menú",-1)),k.value?(l(),d("div",X,[w(s("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>g.value=o),class:"border p-2 rounded-lg w-full mb-4"},[t[2]||(t[2]=s("option",{disabled:"",value:""},"Seleccionar categoría",-1)),t[3]||(t[3]=s("option",{value:"all"},"Todas las categorías",-1)),(l(!0),d(T,null,C([...new Set(m.value.map(o=>o.category.name))],o=>(l(),d("option",{key:o,value:o},v(o),9,Y))),128))],512),[[F,g.value]]),w(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=o=>f.value=o),placeholder:"Buscar producto...",class:"border p-2 rounded-lg w-full mb-4"},null,512),[[Q,f.value]]),G.value.length>0?(l(),d("div",Z,[t[4]||(t[4]=s("h4",{class:"text-xl font-semibold mb-2"}," Productos Disponibles: ",-1)),s("ul",ee,[(l(!0),d(T,null,C(P.value,o=>{var i;return l(),d("li",{key:o.id,class:"mb-1 flex flex-col"},[s("div",re,[s("img",{src:o.image,alt:"Product Image",class:"h-40 w-full 2xl:max-w-40 object-cover mb-2"},null,8,te),s("span",oe,v(o.name),1),s("span",se,"$"+v(o.price),1),s("div",le,[!n.isEdit||n.isEdit&&_.value?(l(),d("button",{key:0,class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-red-600/80 text-white hover:bg-red-600",onClick:c=>$(o.id)}," - ",8,de)):a("",!0),n.isEdit&&!_.value?(l(),d("button",ne," - ")):a("",!0),s("span",ae,v(((i=n.currentOrder.items.find(c=>c.product_id===o.id))==null?void 0:i.quantity)||0),1),s("button",{class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-approveGreen/80 text-white hover:bg-approveGreen",onClick:c=>M(o,n.selectedTable.id)}," + ",8,ie)])])])}),128))])])):a("",!0)])):a("",!0),s("div",ce,[n.isEdit?a("",!0):(l(),d("button",{key:0,class:"mt-4 px-8 py-2 bg-dangerRed hover:bg-red-800 text-white rounded-lg transition-all duration-300 transform ease-in-out",onClick:q}," Cerrar ")),n.isEdit?a("",!0):(l(),d("button",{key:1,class:"mt-4 px-10 py-2 bg-softBlue hover:bg-blue-800 transition-all transform duration-300 ease-in-out text-white rounded-lg",onClick:R}," Guardar orden ")),n.isEdit?(l(),H(K,{key:2,class:"mt-4 px-8 py-2 bg-dangerRed hover:bg-red-800 text-white rounded-lg transition-all duration-300 transform ease-in-out"})):a("",!0),n.isEdit?(l(),d("button",{key:3,class:"mt-4 px-10 py-2 bg-softBlue hover:bg-blue-800 transition-all transform duration-300 ease-in-out text-white rounded-lg",onClick:A}," Actualizar orden ")):a("",!0)])])])):a("",!0)}};export{ge as default};
