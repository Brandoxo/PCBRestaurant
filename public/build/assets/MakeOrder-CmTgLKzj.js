import{z as $,j as b,r as v,y as F,l as J,A as w,g as d,i as u,o as l,b as s,k as S,B as H,F as q,s as P,t as x,q as Q,c as K,C as R,S as B,x as j}from"./app-BieQIS27.js";import{_ as V}from"./ReturnButton-CUn30yvJ.js";const W=n=>n.items.map(O=>({name:O.product.name,quantity:O.quantity})),X={key:0,class:"w-full px-8"},Y={class:"bg-gray-100 p-8 rounded-xl shadow-lg hover:scale-[1.01] transform transition-transform duration-300 ease-in-out mt-4 lg:mt-0"},Z={key:0,class:"mt-4"},ee=["value"],re={key:0,class:"text-center text-gray-500"},te={class:"list-disc list-inside max-h-96 2xl:max-h-[30rem] overflow-y-auto grid grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4"},oe={class:"bg-white rounded shadow flex justify-between items-center flex-col"},se=["src"],le={class:"font-bold"},ne={class:"font-extrabold text-black text-lg mb-"},ae={class:"flex justify-evenly w-full m-4 text-center items-center"},de=["onClick"],ie={key:1,disabled:"",class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-gray-400/80 text-white cursor-not-allowed"},ce={class:"text-lg font-bold text-gray-700"},ue=["onClick"],me={class:"flex justify-between mt-6"},Oe={__name:"MakeOrder",props:{tables:Object,orders:Object,selectedTable:Object,currentOrder:Object,isEdit:Boolean,localNotes:String},emits:["closeOptions"],setup(n,{emit:O}){const e=n,y=$().props.auth.user,T=b(()=>y&&y.permissions&&y.permissions.includes("edit orders")),f=v(""),D=b(()=>{let r=g.value;return p.value!=="all"?r=r.filter(t=>t.category.name===p.value&&t.is_active):r=r.filter(t=>t.is_active),f.value&&(r=r.filter(t=>t.name.toLowerCase().includes(f.value.toLowerCase().trim()))),r}),h=O;function I(){h("closeOptions"),_(),console.log("Close Options clicked, order reset to normal state:",e.currentOrder)}const m=F(),N=async()=>{if(console.log("Save Order clicked with current order:",e.currentOrder),w(()=>{e.currentOrder.notes=e.localNotes??null}),!e.currentOrder.mesa_id&&!e.currentOrder.room_id||e.currentOrder.items.length===0){m.error("No se puede guardar una orden vacía");return}else B.fire({title:"Guardando orden...",didOpen:()=>{B.showLoading()},timer:2e3}),await E(),j.post("/Orders",e.currentOrder,e.currentTable,{onSuccess:r=>{m.success("Orden guardada exitosamente"),h("handleOrderSaved",r.props.order),console.log("Order saved successfully:",r.props.order)},onError:r=>{m.error("Error al guardar la orden"),console.error("Error saving order:",r)},finally:()=>{m.info("Save order request completed."),console.log("Save order request completed.")}});_(),console.log("Order saved and reset to empty state:",e.currentOrder)},_=()=>{e.currentOrder.mesa_id=null,e.currentOrder.room_id=null,e.currentOrder.items=[],console.log("Order reset to empty state:",e.currentOrder)},g=v([]),C=v(!1),p=v("all"),U=b(()=>p.value==="all"?g.value.filter(r=>r.is_active):g.value.filter(r=>r.category.name===p.value&&r.is_active)),M=async()=>{try{const r=await R.get(route("products.get"));g.value=r.data.data,C.value=!0,console.log("Products data fetched successfully:",g.value)}catch(r){console.error("There was an error fetching the products data!",r)}},A=(r,t)=>{var i;!e.currentOrder.mesa_id&&!e.currentOrder.room_id&&((i=e.selectedTable)!=null&&i.isRoom?e.currentOrder.room_id=t:e.currentOrder.mesa_id=t);const o=e.currentOrder.items.find(c=>c.product_id===r.id);o?o.quantity+=1:e.currentOrder.items.push({product_id:r.id,quantity:1,price:r.price,product:r}),console.log("========================================="),console.log("Current Order:",e.currentOrder),console.log("Add to Order clicked"),console.log("Product added to order:",r),console.log("Current Order:",e.currentOrder)},G=r=>{const t=e.currentOrder.items.findIndex(o=>o.product_id===r);t!==-1&&(e.currentOrder.items[t].quantity>1?e.currentOrder.items[t].quantity-=1:e.currentOrder.items.splice(t,1)),console.log("Remove from Order clicked"),console.log("Product removed from order:",r),console.log("Current Order:",e.currentOrder)};J(()=>{console.log("Selected Table Prop:",e.selectedTable),e.selectedTable&&(e.selectedTable.isRoom?(e.currentOrder.room_id=e.selectedTable.id||null,e.currentOrder.mesa_id=null):(e.currentOrder.mesa_id=e.selectedTable.id||null,e.currentOrder.room_id=null)),M(),console.log("Component mounted.")}),w(()=>e.selectedTable,r=>{if(console.log("Selected Table changed:",r),!r){e.currentOrder.mesa_id=null,e.currentOrder.room_id=null;return}r.isRoom?(e.currentOrder.room_id=r.id||null,e.currentOrder.mesa_id=null):(e.currentOrder.mesa_id=r.id||null,e.currentOrder.room_id=null)});const L=b(()=>e.currentOrder.items.reduce((r,t)=>r+t.price*t.quantity,0)),E=async()=>{var i,c;w(()=>{e.currentOrder.notes=e.localNotes??" n/a"});const r={name:"Hotel Ronda Minerva",address:"Av. Adolfo López Mateos Sur 265, Jardines del Bosque, 44520 Guadalajara, Jal.",phone:"33 3121 4700"},t={table:(((i=e.selectedTable)==null?void 0:i.prefix)||"")+(((c=e.selectedTable)==null?void 0:c.number)||""),notes:e.currentOrder.notes===""?" n/a":e.currentOrder.notes},o=W(e.currentOrder,e.selectedTable);return console.log("Printing Restaurant Order with data:",{businessInfo:r,ticketData:t,ticketItems:o}),await R.post("/print-order",{data:{ticketData:t,ticketItems:o,businessInfo:r}}).then(a=>{if(a.data&&a.data.printData){const k="print://"+a.data.printData;console.clear(),console.log(k),console.log("Print URL:",k),console.log("Ticket Data:",t),console.log("Ticket Items:",o),console.log("Buisness info:",r),window.location.href=k,console.log("Ticket data sent successfully:",a.data)}else console.error("No print data received from server."),console.log(a)}).catch(a=>{console.error("Error sending ticket data:",a)})},z=()=>{var t,o,i,c;const r={mesa_id:(t=e.selectedTable)!=null&&t.isRoom?null:((o=e.selectedTable)==null?void 0:o.id)||e.currentOrder.mesa_id,room_id:(i=e.selectedTable)!=null&&i.isRoom?((c=e.selectedTable)==null?void 0:c.id)||e.currentOrder.room_id:null,status:e.currentOrder.status||"En curso",items:e.currentOrder.items,subtotal:L.value,notes:e.localNotes??null};j.put(`/Order/Update/${e.currentOrder.id}`,r,{onSuccess:a=>{E(),console.log("Payload subtotal sent:",r.subtotal),m.success("Orden actualizada exitosamente"),h("handleOrderUpdated",a.props.order),console.log("Order updated successfully:",a.props.order)},onError:a=>{m.error("Error al actualizar la orden"),console.error("Error updating order:",a)},finally:()=>{m.info("Update order request completed."),console.log("Update order request completed.")}}),_(),console.log("Order updated and reset to empty state:",e.currentOrder)};return console.log(e),(r,t)=>e.selectedTable?(l(),d("div",X,[s("div",Y,[t[6]||(t[6]=s("p",{class:"text-center"},"Selecciona una categoría del Menú",-1)),C.value?(l(),d("div",Z,[S(s("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>p.value=o),class:"border p-2 rounded-lg w-full mb-4"},[t[3]||(t[3]=s("option",{disabled:"",value:""},"Seleccionar categoría",-1)),t[4]||(t[4]=s("option",{value:"all"},"Todas las categorías",-1)),(l(!0),d(q,null,P([...new Set(g.value.map(o=>o.category.name))],o=>(l(),d("option",{key:o,value:o},x(o),9,ee))),128))],512),[[H,p.value]]),S(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=o=>f.value=o),placeholder:"Buscar producto...",class:"border p-2 rounded-lg w-full mb-4"},null,512),[[Q,f.value]]),U.value.length>0?(l(),d("div",re,[t[5]||(t[5]=s("h4",{class:"text-xl font-semibold mb-2"}," Productos Disponibles: ",-1)),s("ul",te,[(l(!0),d(q,null,P(D.value,o=>{var i;return l(),d("li",{key:o.id,class:"mb-1 flex flex-col"},[s("div",oe,[s("img",{src:o.image,alt:"Product Image",class:"h-40 w-full 2xl:max-w-40 object-cover mb-2"},null,8,se),s("span",le,x(o.name),1),s("span",ne,"$"+x(o.price),1),s("div",ae,[!n.isEdit||n.isEdit&&T.value?(l(),d("button",{key:0,class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-red-600/80 text-white hover:bg-red-600",onClick:c=>G(o.id)}," - ",8,de)):u("",!0),n.isEdit&&!T.value?(l(),d("button",ie," - ")):u("",!0),s("span",ce,x(((i=n.currentOrder.items.find(c=>c.product_id===o.id))==null?void 0:i.quantity)||0),1),s("button",{class:"text-sm rounded-md px-4 py-1 uppercase font-extrabold bg-approveGreen/80 text-white hover:bg-approveGreen",onClick:c=>A(o,n.selectedTable.id)}," + ",8,ue)])])])}),128))])])):u("",!0)])):u("",!0),s("div",me,[n.isEdit?u("",!0):(l(),d("button",{key:0,class:"mt-4 px-8 py-2 bg-dangerRed hover:bg-red-800 text-white rounded-lg transition-all duration-300 transform ease-in-out",onClick:I}," Cerrar ")),n.isEdit?u("",!0):(l(),d("button",{key:1,class:"mt-4 px-10 py-2 bg-softBlue hover:bg-blue-800 transition-all transform duration-300 ease-in-out text-white rounded-lg",onClick:t[2]||(t[2]=async()=>await N())}," Guardar orden ")),n.isEdit?(l(),K(V,{key:2,class:"mt-4 px-8 py-2 bg-dangerRed hover:bg-red-800 text-white rounded-lg transition-all duration-300 transform ease-in-out"})):u("",!0),n.isEdit?(l(),d("button",{key:3,class:"mt-4 px-10 py-2 bg-softBlue hover:bg-blue-800 transition-all transform duration-300 ease-in-out text-white rounded-lg",onClick:z}," Actualizar orden ")):u("",!0)])])])):u("",!0)}};export{Oe as default};
