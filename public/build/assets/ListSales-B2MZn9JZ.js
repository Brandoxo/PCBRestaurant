import{y as L,m,j as _,g as h,o as y,b as e,a as O,k as v,p as F,F as V,q as U,t as s,w as E,i as Q,f as S,z as H,A as X}from"./app-BZAdpixh.js";import{_ as z}from"./Modal-Bx_EIeB3.js";const Y={class:"bg-white p-4 rounded-2xl"},J={class:"flex gap-4 justify-between mx-auto"},K={class:"w-full mt-2 border"},R={class:"border p-2 text-center"},W={class:"border p-2 text-center"},Z={class:"border p-2 text-center"},tt={class:"border p-2 text-center"},et={class:"border p-2 text-center"},rt={class:"border p-2 text-center"},ot={class:"border p-2 text-center"},at={class:"border p-2 text-center"},nt={class:"p-8 bg-gradient-to-br from-white via-gray-50 to-gray-200 rounded-2xl shadow-2xl mx-auto"},st={key:0,class:"mb-4"},lt={class:"flex justify-end gap-3 mt-8"},ut={__name:"ListSales",props:{sales:Array},setup(G){const i=G,w=L().props.auth.user;console.log("props in <ListSales>: ",i.sales),console.log("user in <ListSales>: ",w);const c=m(""),j=_(()=>{let o=[...i.sales].sort((t,r)=>r.id-t.id);return c.value?o.filter(t=>new Date(t.date_time).toISOString().split("T")[0]===c.value):o}),u=m(!1),N=()=>{u.value=!0},D=o=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(o),q=(o,t)=>`${o} x ${D(t)}`,A=(o,t)=>D(o*t),d={morning:"Mañana",afternoon:"Tarde"},b=o=>{const t=new Date(o).getHours();return t>=7&&t<15?d.morning:t>=15&&t<23?d.afternoon:"Fuera de turno"},B=_(()=>{const o={};return i.sales.forEach(t=>{const r=new Date(t.date_time).toISOString().split("T")[0],g=b(t.date_time);o[r]||(o[r]={morning:[],afternoon:[],other:[]}),g===d.morning?o[r].morning.push(t):g===d.afternoon?o[r].afternoon.push(t):o[r].other.push(t)}),o});console.log("Sales grouped by day and shift:",B.value);const x=o=>i.sales.filter(t=>b(t.date_time)===o).reduce((t,r)=>t+r.quantity*r.unit_price,0);console.log("Total sales in the morning:",x(d.morning)),console.log("Total sales in the afternoon:",x(d.afternoon)),console.log("Total sales outside shifts:",x("Fuera de turno"));const I=_(()=>i.sales.reduce((o,t)=>o+t.quantity*t.unit_price,0));console.log("Grand total of sales:",I.value);function C(o){const t=new Date(o);return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")+" "+String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0")}const p=m(""),l=m(""),P=async()=>{const o=w.id;let t=i.sales;if(p.value&&(t=t.filter(a=>new Date(a.date_time).toISOString().split("T")[0]===p.value)),l.value){let a=l.value;a==="Matutino"&&(a="Mañana"),a==="Vespertino"&&(a="Tarde"),a==="Otro"&&(a="Fuera de turno"),t=t.filter(n=>b(n.date_time)===a)}if(t.length===0){alert("No hay ventas para la fecha y turno seleccionados.");return}const r=new Date(Math.min(...t.map(a=>new Date(a.date_time)))),g=r,$=r,M=t.reduce((a,n)=>a+n.quantity*n.unit_price,0),T=t.reduce((a,n)=>{let f=0;return n.order.tip!==null&&n.order.tip!==void 0&&n.order.tip!==""&&(f=parseFloat(n.order.tip)),a+f},0),k=t.reduce((a,n)=>{const f=n.order&&n.order.tip_percent?parseFloat(n.order.tip_percent):0;return a+n.quantity*n.unit_price*(f/100)},0);try{const a=await X.post("/CashAudit",{user_id:o,start_date:C(g),end_date:C($),shift:l.value,initial_amount:3500,total_amount:M,final_amount:3500+M,total_tips:T+k});console.log("Corte de caja guardado:",a.data),alert(`Corte de caja generado y guardado exitosamente.
Propinas: $${(T+k).toFixed(2)}`)}catch(a){console.error("Error al guardar el corte de caja:",a),alert("Error al generar y guardar el corte de caja.")}};return(o,t)=>(y(),h(V,null,[e("div",Y,[e("div",J,[v(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>c.value=r),type:"date",placeholder:"Buscar Ventas por fecha",class:"border p-2 rounded-lg w-full"},null,512),[[F,c.value]]),e("button",{onClick:N,class:"bg-approveGreen hover:bg-green-700 transform *: text-white px-4 py-2 lg:w-96 rounded-md uppercase"}," Generar Corte de Caja ")]),e("table",K,[t[6]||(t[6]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"p-4"},"#"),e("th",{class:"p-4"},"Fecha de Creación"),e("th",{class:"p-4"},"Orden ID"),e("th",{class:"p-4"},"Usuario"),e("th",{class:"p-4"},"Producto"),e("th",{class:"p-4"},"Subtotal"),e("th",{class:"p-4"},"Total"),e("th",{class:"p-4"},"Método de Pago")])],-1)),e("tbody",null,[(y(!0),h(V,null,U(j.value,r=>(y(),h("tr",{key:r.id},[e("td",R,s(r.id),1),e("td",W,s(r.date_time),1),e("td",Z,s(r.order_id),1),e("td",tt,s(r.user.name),1),e("td",et,s(r.product?r.product.name:r.product_id),1),e("td",rt,s(q(r.quantity,r.unit_price)),1),e("td",ot,s(A(r.quantity,r.unit_price)),1),e("td",at,s(r.payment_method),1)]))),128))])])]),O(z,{show:u.value,"onUpdate:show":t[4]||(t[4]=r=>u.value=r),onClose:t[5]||(t[5]=r=>u.value=!1)},{default:E(()=>[e("div",nt,[t[10]||(t[10]=e("h3",{class:"text-2xl font-extrabold text-gray-800 mb-2 flex items-center gap-2"},[e("svg",{class:"w-7 h-7 text-approveGreen",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{d:"M12 8v4l3 3"}),e("circle",{cx:"12",cy:"12",r:"10"})]),S(" Generar Corte ")],-1)),t[11]||(t[11]=e("p",{class:"mb-6 text-gray-600 text-base"},[S(" ¿Cuál será el "),e("span",{class:"font-semibold text-approveGreen"},"Turno"),S(" para este corte de caja? ")],-1)),v(e("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>l.value=r),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-4"},[...t[7]||(t[7]=[e("option",{value:"",disabled:""},"Seleccione un turno",-1),e("option",{value:"Matutino"},"Mañana (7am - 3pm)",-1),e("option",{value:"Vespertino"},"Tarde (3pm - 11pm)",-1)])],512),[[H,l.value]]),l.value==="Matutino"||l.value==="Vespertino"?(y(),h("div",st,[t[8]||(t[8]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Selecciona la fecha",-1)),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>p.value=r),type:"date",class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition"},null,512),[[F,p.value]])])):Q("",!0),e("div",lt,[e("button",{onClick:t[3]||(t[3]=r=>u.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Cancelar "),t[9]||(t[9]=e("button",{class:"bg-green-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Imprimir ",-1)),e("button",{onClick:P,class:"bg-approveGreen hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition"}," Generar Corte ")])])]),_:1},8,["show"])],64))}};export{ut as default};
