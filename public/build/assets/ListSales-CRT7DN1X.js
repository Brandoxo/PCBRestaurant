import{z as Q,m,j as v,g as h,o as y,b as o,a as H,k as x,p as F,F as k,q as R,t as s,w as X,i as z,f as S,A as J,B as P}from"./app-u6hxeLHg.js";import{_ as K}from"./Modal-BgJ842Cl.js";const W={class:"bg-white p-4 rounded-2xl"},Z={class:"flex gap-4 justify-between mx-auto"},tt={class:"w-full mt-2 border"},et={class:"border p-2 text-center"},rt={class:"border p-2 text-center"},ot={class:"border p-2 text-center"},at={class:"border p-2 text-center"},nt={class:"border p-2 text-center"},st={class:"border p-2 text-center"},lt={class:"border p-2 text-center"},it={class:"border p-2 text-center"},dt={class:"p-8 bg-gradient-to-br from-white via-gray-50 to-gray-200 rounded-2xl shadow-2xl mx-auto"},ut={key:0,class:"mb-4"},ct={class:"flex justify-end gap-3 mt-8"},ft={__name:"ListSales",props:{sales:Array},setup(V){const i=V,w=Q().props.auth.user;console.log("props in <ListSales>: ",i.sales),console.log("user in <ListSales>: ",w);const f=m(""),j=v(()=>{let e=[...i.sales].sort((t,r)=>r.id-t.id);return f.value?e.filter(t=>{const r=new Date(t.date_time);return r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0")===f.value}):e}),c=m(!1),G=()=>{c.value=!0},D=e=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(e),A=(e,t)=>`${e} x ${D(t)}`,B=(e,t)=>D(e*t),d={morning:"Mañana",afternoon:"Tarde"},b=e=>{const t=new Date(e).getHours();return t>=7&&t<15?d.morning:t>=15&&t<23?d.afternoon:"Fuera de turno"},N=v(()=>{const e={};return i.sales.forEach(t=>{const r=new Date(t.date_time),a=b(t.date_time),l=r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0");e[l]||(e[l]={morning:[],afternoon:[],other:[]}),a===d.morning?e[l].morning.push(t):a===d.afternoon?e[l].afternoon.push(t):e[l].other.push(t)}),e});console.log("Sales grouped by day and shift:",N.value);const _=e=>i.sales.filter(t=>b(t.date_time)===e).reduce((t,r)=>t+r.quantity*r.unit_price,0);console.log("Total sales in the morning:",_(d.morning)),console.log("Total sales in the afternoon:",_(d.afternoon)),console.log("Total sales outside shifts:",_("Fuera de turno"));const q=v(()=>i.sales.reduce((e,t)=>e+t.quantity*t.unit_price,0));console.log("Grand total of sales:",q.value);function C(e){const t=new Date(e);return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")+" "+String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0")}const p=m(""),n=m("");function g(){let e=i.sales;if(p.value&&(e=e.filter(t=>{const r=new Date(t.date_time);return r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0")===p.value})),n.value){let t=n.value;t==="Matutino"&&(t="Mañana"),t==="Vespertino"&&(t="Tarde"),t==="Otro"&&(t="Fuera de turno"),e=e.filter(r=>b(r.date_time)===t)}return e.is_courtesy!=null&&!e.is_courtesy&&(e=e.filter(t=>t.is_courtesy===e.is_courtesy)),console.log(e),e}function E(e){return e.length?new Date(Math.min(...e.map(t=>new Date(t.date_time)))):null}function u(e){return e.reduce((t,r)=>t+r.quantity*r.unit_price,0)}function M(e){const t=new Set;let r=0;return e.forEach(a=>{a.order&&!t.has(a.order.id)&&a.order.tip!==null&&a.order.tip!==void 0&&a.order.tip!==""&&(r+=parseFloat(a.order.tip),t.add(a.order.id))}),r}function T(e){return e.reduce((t,r)=>{const a=r.order&&r.order.tip_percent?parseFloat(r.order.tip_percent):0;return t+r.quantity*r.unit_price*(a/100)},0)}function O(){const e=g();if(!e.length)return null;const t=E(e),r=u(e),a=M(e),l=T(e);return{user_id:w.id,start_date:C(t),end_date:C(t),shift:n.value,initial_amount:3500,total_amount:r,final_amount:3500+r,total_tips:a+l}}function U(){let e=g();return e=e.filter(t=>t.payment_method==="Efectivo"),e}function $(){let e=g();return e=e.filter(t=>t.payment_method==="Tarjeta"),e}function I(){let e=g();return e=e.filter(t=>t.is_courtesy===1),e}const L=async()=>{const e=O();if(!e){alert("No hay ventas para la fecha y turno seleccionados.");return}try{const t=await P.post("/CashAudit",e);console.log("Corte de caja guardado:",t.data),alert(`Corte de caja generado y guardado exitosamente.
Propinas: $${e.total_tips.toFixed(2)}`)}catch(t){console.error("Error al guardar el corte de caja:",t),alert("Error al generar y guardar el corte de caja.")}},Y=()=>{const e=g();if(!e.length){alert("No hay ventas para la fecha y turno seleccionados."),console.log(e);return}const t={fecha:p.value,turno:n.value,totalVentas:u(e),montoFinal:3500+u(e),totalPropinas:M(e)+T(e),totalEfectivo:u(U()),totalTarjeta:u($()),totalCortesias:u(I())};P.get(route("print.cutOff"),{params:{data:t}}).then(r=>{if(r.data&&r.data.printData){const a="print://"+r.data.printData;console.log("Print URL:",a),console.log("Raw Cut-Off Data:",r.data),window.location.href=a}})};return(e,t)=>(y(),h(k,null,[o("div",W,[o("div",Z,[x(o("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>f.value=r),type:"date",placeholder:"Buscar Ventas por fecha",class:"border p-2 rounded-lg w-full"},null,512),[[F,f.value]]),o("button",{onClick:G,class:"bg-approveGreen hover:bg-green-700 transform *: text-white px-4 py-2 lg:w-96 rounded-md uppercase"}," Generar Corte de Caja ")]),o("table",tt,[t[6]||(t[6]=o("thead",null,[o("tr",{class:"bg-gray-100"},[o("th",{class:"p-4"},"#"),o("th",{class:"p-4"},"Fecha de Creación"),o("th",{class:"p-4"},"Orden ID"),o("th",{class:"p-4"},"Usuario"),o("th",{class:"p-4"},"Producto"),o("th",{class:"p-4"},"Subtotal"),o("th",{class:"p-4"},"Total"),o("th",{class:"p-4"},"Método de Pago")])],-1)),o("tbody",null,[(y(!0),h(k,null,R(j.value,r=>(y(),h("tr",{key:r.id},[o("td",et,s(r.id),1),o("td",rt,s(r.date_time),1),o("td",ot,s(r.order_id),1),o("td",at,s(r.user.name),1),o("td",nt,s(r.product?r.product.name:r.product_id),1),o("td",st,s(A(r.quantity,r.unit_price)),1),o("td",lt,s(B(r.quantity,r.unit_price)),1),o("td",it,s(r.payment_method),1)]))),128))])])]),H(K,{show:c.value,"onUpdate:show":t[4]||(t[4]=r=>c.value=r),onClose:t[5]||(t[5]=r=>c.value=!1)},{default:X(()=>[o("div",dt,[t[9]||(t[9]=o("h3",{class:"text-2xl font-extrabold text-gray-800 mb-2 flex items-center gap-2"},[o("svg",{class:"w-7 h-7 text-approveGreen",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[o("path",{d:"M12 8v4l3 3"}),o("circle",{cx:"12",cy:"12",r:"10"})]),S(" Generar Corte ")],-1)),t[10]||(t[10]=o("p",{class:"mb-6 text-gray-600 text-base"},[S(" ¿Cuál será el "),o("span",{class:"font-semibold text-approveGreen"},"Turno"),S(" para este corte de caja? ")],-1)),x(o("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>n.value=r),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-4"},[...t[7]||(t[7]=[o("option",{value:"",disabled:""},"Seleccione un turno",-1),o("option",{value:"Matutino"},"Mañana (7am - 3pm)",-1),o("option",{value:"Vespertino"},"Tarde (3pm - 11pm)",-1)])],512),[[J,n.value]]),n.value==="Matutino"||n.value==="Vespertino"?(y(),h("div",ut,[t[8]||(t[8]=o("label",{class:"block text-gray-700 font-medium mb-2"},"Selecciona la fecha",-1)),x(o("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>p.value=r),type:"date",class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition"},null,512),[[F,p.value]])])):z("",!0),o("div",ct,[o("button",{onClick:t[3]||(t[3]=r=>c.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Cancelar "),o("button",{onClick:Y,class:"bg-green-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Imprimir "),o("button",{onClick:L,class:"bg-approveGreen hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition"}," Generar Corte ")])])]),_:1},8,["show"])],64))}};export{ft as default};
