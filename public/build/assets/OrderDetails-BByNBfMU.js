import{m as v,y as I,g as a,o as s,b as t,i as d,a as M,F as C,q as E,f as i,t as w,d as S,k as h,v as O,w as U,A as G,p as A,B as F,S as k,s as _}from"./app-BsmVB6Bw.js";import{_ as H}from"./Modal-UKDxrgvS.js";import{S as L}from"./Switch-xxwSUS2H.js";import{f as P,a as Y}from"./currencyFormatter-WI6XgGo9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"bg-white p-6 rounded-lg shadow-md flex overflow-y-auto justify-between max-h-64 hover:scale-[1.02] transition-all transform ease-in-out duration-300"},R={class:"flex flex-col gap-2"},z={key:0,src:"assets/icons/svg/details/utensils.svg",alt:"Food Icon",class:"inline w-5 ml-2 cursor-pointer"},W={key:1,src:"assets/icons/svg/details/drink.svg",alt:"Drink Icon",class:"inline w-5 ml-2 cursor-pointer"},K={key:1,class:"text-gray-400"},Q={key:0,class:"h-fit overflow-auto flex flex-col gap-2 items-end"},X={key:0,class:"text-center"},Z={key:1,class:"text-gray-400"},ee={class:"flex gap-4 flex-col md:flex-row"},te={class:"bg-white p-6 rounded-lg shadow-md flex h-fit w-full justify-between hover:scale-[1.02] transition-all transform ease-in-out duration-300 items-center"},oe={class:"flex items-center gap-4"},re={class:"font-bold text-2xl 2xl:text-3xl"},ae={key:0,class:"bg-white p-4 rounded-lg shadow-md w-fit hover:scale-[1.02] transition-all transform ease-in-out duration-300 flex-col text-center"},se={class:"inline-flex items-center cursor-pointer flex-col gap-1 font-bold"},ne={key:0,class:"bg-gradient-to-br from-white via-gray-50 to-gray-200 p-4 rounded-2xl shadow-2xl mx-auto"},le={class:"flex justify-end gap-3 mt-8"},ie={key:1,class:"p-8 bg-gradient-to-br from-white via-gray-50 to-gray-200 rounded-2xl shadow-2xl mx-auto"},de={key:0,class:"mb-4"},ue={key:0,class:"mt-2"},ce={class:"flex justify-end gap-3 mt-8"},me={__name:"OrderDetails",props:{order:Object},setup(l){const r=l,u=v(!1),D=()=>{u.value=!1},x=v("Efectivo"),g=v("0"),m=v(""),c=I().props.auth.user,b=v(!1);console.log("order prop in <OrderDetails>: ",r.order);const j=[1,2,3,4,6,7,8,20],q=[5,9,10,11,12,13,14,15,16,17,18,19],N=async()=>{D(),(await k.fire({icon:"info",title:"Estás segur@ de cobrar la orden?",text:"Asegurate primero de haber cobrado el monto correcto.",showCancelButton:!0,confirmButtonText:"Sí, cobrar",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#d33"})).isConfirmed&&r.order&&r.order.id&&r.order.order_details&&(await _.post(`/Order/AddTip/${r.order.id}`,{tip_percent:g.value?Number(g.value):null,tip:m.value?Number(m.value):null}),await _.post("/Sales/Create",{order_id:r.order.id,user_id:c.id,cash_audit_id:null,payment_method:x.value,sales:r.order.order_details.map(e=>({product_id:e.product_id,quantity:e.quantity,unit_price:e.unit_price??(e.product?e.product.price:0),subtotal:e.total??e.quantity*(e.unit_price??(e.product?e.product.price:0)),is_courtesy:b.value?1:0}))}),k.fire({icon:"success",title:"¡Venta creada exitosamente!",showConfirmButton:!1,timer:1500}))},$=async()=>{D(),(await k.fire({icon:"info",title:"Estás segur@ de crear una cortesía?",text:"Asegurate primero de haber revisado la orden.",showCancelButton:!0,confirmButtonText:"Sí, crear cortesía",cancelButtonText:"Cancelar",confirmButtonColor:"#28a745",cancelButtonColor:"#d33"})).isConfirmed&&r.order&&r.order.id&&r.order.order_details&&(await _.post("/Sales/Create",{order_id:r.order.id,user_id:c.id,cash_audit_id:null,payment_method:"Cortesía",sales:r.order.order_details.map(e=>({product_id:e.product_id,quantity:e.quantity,unit_price:e.unit_price??(e.product?e.product.price:0),subtotal:e.total??e.quantity*(e.unit_price??(e.product?e.product.price:0)),is_courtesy:1}))}),k.fire({icon:"success",title:"¡Cortesía creada exitosamente!",showConfirmButton:!1,timer:1500}))},V=()=>{if(r.order&&r.order.id){const f={total:r.order.total,items:r.order.order_details.length,cash:r.order.total,change:0,user_id:c.name,updated_at:new Date().getFullYear()+"-"+(new Date().getMonth()+1)+"-"+new Date().getDate()+" "+new Date().getHours()+":"+new Date().getMinutes(),created_at:new Date().getFullYear()+"-"+(new Date().getMonth()+1)+"-"+new Date().getDate()+" "+new Date().getHours()+":"+new Date().getMinutes(),id:r.order.id,user:{id:c.id,name:c.name,email:c.email,role:c.role},table:r.order.table?r.order.table.number:0},e=r.order.order_details.map(n=>({price:n.unit_price??(n.product?n.product.price:0),quantity:n.quantity,name:n.product?n.product.name:""})),y={name:"Hotel Ronda Minerva",address:"Av. Adolfo López Mateos Sur 265, Jardines del Bosque, 44520 Guadalajara, Jal.",phone:"33 3121 4700"};F.get("/print-ticket/",{params:{data:{ticketData:f,ticketItems:e,businessInfo:y}}}).then(n=>{if(n.data&&n.data.printData){const p="print://"+n.data.printData;console.clear(),console.log(p),console.log("Print URL:",p),window.location.href=p,console.log("Ticket data sent successfully:",n.data)}else console.error("No print data received from server.")}).catch(n=>{console.error("Error sending ticket data:",n)})}else console.error("No order data available to print ticket.")};return(f,e)=>{var y,n,p,B,T;return s(),a(C,null,[e[20]||(e[20]=t("h2",{class:"text-lg font-semibold mt-2 text-center text-white"}," Detalles de la orden ",-1)),t("div",J,[t("div",R,[l.order&&l.order.order_details&&l.order.order_details.length?(s(!0),a(C,{key:0},E(l.order.order_details,o=>(s(),a("span",{key:o.id},[o.product&&j.includes(o.product.category_id)?(s(),a("img",z)):o.product&&q.includes(o.product.category_id)?(s(),a("img",W)):d("",!0),i(" "+w(o.quantity)+" x "+w(o.product?o.product.name:""),1)]))),128)):(s(),a("span",K,"No hay detalles para esta orden."))]),l.order&&l.order.order_details&&l.order.order_details.length?(s(),a("div",Q,[(s(!0),a(C,null,E(l.order.order_details,o=>(s(),a("div",{key:o.id},[o.product&&o.product.category_id===2?(s(),a("span",X)):d("",!0),i(" $"+w(S(P).format(o.unit_price)),1)]))),128))])):(s(),a("span",Z,"No hay detalles para esta orden."))]),((y=l.order)==null?void 0:y.status)==="En curso"?(s(),a("button",{key:0,onClick:e[0]||(e[0]=o=>f.$inertia.get(`/Order/Edit/${l.order.id}`)),class:"bg-orangeYellow hover:bg-yellow-600 transform transition-all duration-300 ease-in-out text-white py-2 px-4 rounded uppercase text-sm font-extrabold"}," Editar Orden ")):d("",!0),t("div",ee,[t("div",te,[e[10]||(e[10]=t("h3",{class:"font-bold text-3xl mr-2"},"Total:",-1)),t("div",oe,[t("span",re,w(S(Y).format((n=r.order)!=null&&n.total?r.order.total:0)),1),((p=r.order)==null?void 0:p.status)==="En curso"?(s(),a("button",{key:0,onClick:e[1]||(e[1]=o=>u.value=!0),class:"bg-approveGreen hover:bg-green-900 transition-all transform duration-300 ease-in-out text-white px-4 py-2 rounded-lg uppercase text-sm font-extrabold"}," Cobrar ")):d("",!0)])]),((B=l.order)==null?void 0:B.status)==="En curso"?(s(),a("div",ae,[t("label",se,[e[11]||(e[11]=i(" ¿Cortesía? ",-1)),h(t("input",{type:"checkbox",class:"sr-only peer","onUpdate:modelValue":e[2]||(e[2]=o=>b.value=o),id:"is_active"},null,512),[[O,b.value]]),M(L)])])):d("",!0)]),(T=r.order)!=null&&T.status?(s(),a("button",{key:1,onClick:V,class:"bg-approveGreen hover:bg-green-900 transition-all transform duration-300 ease-in-out text-white px-2 py-2 uppercase font-extrabold rounded-lg text-sm"}," Imprimir Ticket ")):d("",!0),M(H,{show:u.value,"onUpdate:show":e[8]||(e[8]=o=>u.value=o),onClose:e[9]||(e[9]=o=>u.value=!1)},{default:U(()=>[b.value===!0?(s(),a("div",ne,[e[12]||(e[12]=t("h2",{class:"text-2xl font-extrabold text-gray-800 mb-2 flex items-center gap-2"},[t("svg",{class:"w-7 h-7 text-approveGreen",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{d:"M12 8v4l3 3"}),t("circle",{cx:"12",cy:"12",r:"10"})]),i(" Crear Cortesía ")],-1)),e[13]||(e[13]=t("p",{class:"mb-6 text-gray-600 text-base"},[i(" ¿Estás seguro de "),t("span",{class:"font-semibold text-approveGreen"},"crear cortesía"),i(" para esta orden? ")],-1)),t("div",le,[t("button",{onClick:e[3]||(e[3]=o=>u.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Cancelar "),t("button",{onClick:$,class:"bg-approveGreen hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition"}," Sí, Crear Cortesía ")])])):(s(),a("div",ie,[e[18]||(e[18]=t("h3",{class:"text-2xl font-extrabold text-gray-800 mb-2 flex items-center gap-2"},[t("svg",{class:"w-7 h-7 text-approveGreen",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{d:"M12 8v4l3 3"}),t("circle",{cx:"12",cy:"12",r:"10"})]),i(" Cobrar Orden ")],-1)),e[19]||(e[19]=t("p",{class:"mb-6 text-gray-600 text-base"},[i(" ¿Cuál será el "),t("span",{class:"font-semibold text-approveGreen"},"método de pago"),i(" para esta orden? ")],-1)),h(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>x.value=o),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-4"},[...e[14]||(e[14]=[t("option",{value:"Efectivo"},"Efectivo",-1),t("option",{value:"Tarjeta"},"Tarjeta de Crédito/Débito",-1)])],512),[[G,x.value]]),x.value==="Tarjeta"?(s(),a("div",de,[e[17]||(e[17]=t("label",{class:"block text-gray-700 font-medium mb-2"},"El cliente gusta dejar propina de:",-1)),h(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>g.value=o),class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition mb-2"},[...e[15]||(e[15]=[t("option",{value:"0"},"No dejar propina",-1),t("option",{value:"5"},"5%",-1),t("option",{value:"10"},"10%",-1),t("option",{value:"15"},"15%",-1),t("option",{value:"20"},"20%",-1),t("option",{value:"otherTip"},"Otro",-1)])],512),[[G,g.value]]),g.value==="otherTip"?(s(),a("div",ue,[e[16]||(e[16]=t("label",{class:"block text-gray-700 font-medium mb-1"},"Ingrese el monto de propina:",-1)),h(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>m.value=o),type:"number",min:"0",class:"border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-approveGreen focus:outline-none transition",placeholder:"Monto de propina"},null,512),[[A,m.value]])])):d("",!0)])):d("",!0),t("div",ce,[t("button",{onClick:e[7]||(e[7]=o=>u.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition"}," Cancelar "),t("button",{onClick:N,class:"bg-approveGreen hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition"}," Sí, Cobrar ")])]))]),_:1},8,["show"])],64)}}};export{me as default};
