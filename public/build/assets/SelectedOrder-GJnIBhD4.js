import{z as L,j as h,r as V,A as j,g as a,o as l,i as g,b as o,t as r,f as C,F as D,s as T,D as I,E as P,S as i,x as k}from"./app-CnN0QQFD.js";const A={key:0,class:"bg-white shadow-md rounded-lg p-2 px-4 w-3/4 lg:w-full mt-4 mx-auto hover:scale-[1.02] transition-all transform ease-in-out duration-300"},F={key:0,class:"flex bg-red-100 text-center text-red-600 py-1 rounded-full text-sm font-semibold w-full mt-2 lg:mt-0"},M={class:"mx-auto"},z={key:1,class:"flex bg-approveGreen/30 text-center text-approveGreen py-1 rounded-full text-sm font-semibold w-full mt-2 lg:mt-0"},G={class:"lg:flex justify-between items-center"},K={class:"md:text-lg lg:text-xl"},R={class:"font-extrabold"},$={class:"uppercase font-extrabold text-sm"},U=["value","onInput","onKeyup","disabled"],q={class:"flex items-center justify-between gap-4 mt-4"},H={class:"flex-col"},J={class:"text-center text-3xl font-bold"},Q={key:0},W={key:1},X={class:"flex text-sm mt-2 gap-2 justify-between"},Y={class:"text-center text-secondary"},Z={class:"text-center text-secondary"},_={class:"gap-2 text-center"},ee={class:"text-center text-midBlue font-bold"},te={key:1,class:"mx-auto w-3/4 bg-white rounded-lg p-4 mt-4"},se={__name:"SelectedOrder",props:{order:Object,notes:Array},setup(t){const c=L().props.auth.user,n=t;console.log("notes in SelectedOrder:",n.notes),console.log("order in:",n.order);const E=()=>{i.fire({title:"¿Estás seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, cancelar orden",cancelButtonText:"Cancelar",input:"select",inputLabel:"Motivo de la cancelación",inputOptions:{"Cliente pidió cancelar":"Cliente pidió cancelar","Cliente cambió de opinión":"Cliente cambió de opinión","Cliente se retiró":"Cliente se retiró","Problema de inventario":"Problema de inventario","Error en el pedido":"Error en el pedido",Otro:"Otro"},inputValidator:s=>{if(s==="Otro")return i.fire({title:"Por favor, ingresa el motivo de la cancelación:",input:"text",inputPlaceholder:"Escribe el motivo aquí...",showCancelButton:!0,confirmButtonText:"Enviar",cancelButtonText:"Cancelar",preConfirm:e=>(e||i.showValidationMessage("¡Necesitas ingresar un motivo!"),e)}).then(e=>{if(e.isConfirmed){const d=e.value;x(d),i.fire("¡Cancelada!","La orden ha sido cancelada.","success")}});if(!s)return"¡Necesitas seleccionar un motivo!"}}).then(s=>{if(s.isConfirmed){const e=s.value;x(e),i.fire("¡Cancelada!","La orden ha sido cancelada.","success")}})},x=async s=>{try{await k.post(`/orders/update/${n.order.id}`,{status:"Cancelada",user_name:c.name,cancellation_reason:s},{preserveState:!0,onSuccess:()=>{n.order.status="Cancelada",console.log("Orden cancelada"),n.notes.cancellation_reason=s},onError:e=>{console.error("Error al cancelar la orden:",e)}})}catch(e){console.error("Error en la solicitud:",e)}},B=h(()=>c&&c.permissions&&c.permissions.includes("cancel orders"));console.log("User permissions:",c?c.permissions:"No user");const v=h(()=>!n.order||!n.notes?[]:n.notes.filter(s=>s.order_id===n.order.id));console.log("Filtered notes:",v.value);const N=V([]);j(v,s=>{N.value=s.map(e=>e.content)},{immediate:!0});const O=async(s,e)=>{try{i.fire({title:"Guardando nota...",allowOutsideClick:!1,didOpen:()=>{i.showLoading()}}),await k.put(`/Notes/Update/${s}`,{content:e},{preserveState:!0,onSuccess:()=>{i.close(),console.log("Nota guardada")},onError:d=>{console.error("Error al guardar la nota:",d)}})}catch(d){console.error("Error en la solicitud:",d)}},S=[{status:"En curso",input:"Notas:"},{status:"Cancelada",input:"Motivo:"},{status:"Completada",input:"Notas:"}];return(s,e)=>{var d,f,p,b,w;return t.order?(l(),a("div",A,[t.order.status==="Cancelada"?(l(),a("div",F,[o("span",M," Cancelada por "+r(t.order.cancelled_by??"Admin"),1)])):g("",!0),t.order.status==="Completada"?(l(),a("div",z,[...e[0]||(e[0]=[o("span",{class:"mx-auto"}," Venta Finalizada ",-1)])])):g("",!0),o("div",G,[o("h2",K,[e[1]||(e[1]=C(" Orden ",-1)),o("span",R,"ID # "+r(t.order.id??"0000"),1),e[2]||(e[2]=o("img",{src:"assets/icons/svg/links/copy.svg",alt:"Copy Icon",class:"inline w-6 ml-2 cursor-pointer"},null,-1))]),(l(!0),a(D,null,T(v.value,u=>{var y;return l(),a("div",{key:u.id,class:"flex items-center gap-2 mt-2 lg:mt-0 2xl:w-3/4"},[o("p",$,r((y=S.find(m=>m.status===t.order.status))==null?void 0:y.input),1),o("input",{type:"text",value:t.order.status==="Cancelada"?u.cancellation_reason:u.content,onInput:m=>u.content=m.target.value,onKeyup:I(m=>O(u.id,u.content),["enter"]),class:"border border-gray-300 rounded-md p-2 w-full bg-yellow-50",disabled:t.order.status==="Cancelada"||t.order.status==="Completada"},null,40,U),e[3]||(e[3]=o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 inline text-black",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h5m-1.5-10l4 4m0 0l4-4m-4 4V3"})],-1))])}),128))]),o("div",q,[o("div",H,[o("h2",J,[C(r(((d=t.order.table)==null?void 0:d.name)??((f=t.order.room)==null?void 0:f.name.slice(0,3))+"."??"N/A")+" ",1),t.order.room?(l(),a("span",Q,r((p=t.order.room)==null?void 0:p.prefix)+"-"+r((b=t.order.room)==null?void 0:b.number),1)):t.order.table?(l(),a("span",W,r((w=t.order.table)==null?void 0:w.number),1)):g("",!0)]),o("div",X,[o("p",Y,r(t.order.date_time?new Date(t.order.date_time).toLocaleTimeString().slice(0,5):"-"),1),o("p",Z,r(t.order.date_time?new Date(t.order.date_time).toLocaleDateString():"-"),1)])]),t.order.status==="En curso"&&B.value?(l(),a("button",{key:0,onClick:E,class:"py-4 bg-dangerRed/30 max-w-96 p-2 rounded-md w-1/2 uppercase text-dangerRed tracking-widest font-extrabold hover:bg-dangerRed/50 transition"}," Cancelar ")):g("",!0),o("button",_,[e[4]||(e[4]=o("img",{src:"assets/icons/svg/links/sheet.svg",alt:"Imagen de la orden",class:"w-6 mx-auto"},null,-1)),e[5]||(e[5]=o("p",{class:"text-center text-midBlue font-bold"},"Export",-1)),o("p",ee," #"+r(t.order.id??""),1)])])])):(l(),a("div",te,[...e[6]||(e[6]=[P('<div class="flex animate-pulse space-x-4"><div class="size-10 rounded-full bg-gray-200"></div><div class="flex-1 space-y-6 py-1"><div class="h-2 rounded bg-gray-200"></div><div class="space-y-3"><div class="grid grid-cols-3 gap-4"><div class="col-span-2 h-2 rounded bg-gray-200"></div><div class="col-span-1 h-2 rounded bg-gray-200"></div></div><div class="h-2 rounded bg-gray-200"></div></div></div></div>',1)])]))}}};export{se as default};
